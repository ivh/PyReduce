<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>pyreduce package &#8212; PyReduce unknown documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=3f1b9271"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="pyreduce.clib package" href="pyreduce.clib.html" />
    <link rel="prev" title="PyReduce" href="modules.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="pyreduce-package">
<h1>pyreduce package<a class="headerlink" href="#pyreduce-package" title="Link to this heading">¶</a></h1>
<section id="subpackages">
<h2>Subpackages<a class="headerlink" href="#subpackages" title="Link to this heading">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="pyreduce.clib.html">pyreduce.clib package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pyreduce.clib.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyreduce.clib.html#module-pyreduce.clib.build_extract">pyreduce.clib.build_extract module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="pyreduce.clib.html#pyreduce.clib.build_extract.ffi_builder_vertical"><code class="docutils literal notranslate"><span class="pre">ffi_builder_vertical</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="pyreduce.clib.html#pyreduce.clib.build_extract.ffi_builder_curved"><code class="docutils literal notranslate"><span class="pre">ffi_builder_curved</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="pyreduce.clib.html#pyreduce.clib.build_extract.build"><code class="docutils literal notranslate"><span class="pre">build()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="pyreduce.clib.html#module-pyreduce.clib">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pyreduce.instruments.html">pyreduce.instruments package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pyreduce.instruments.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyreduce.instruments.html#module-pyreduce.instruments.common">pyreduce.instruments.common module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.COMMON"><code class="docutils literal notranslate"><span class="pre">COMMON</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.Instrument"><code class="docutils literal notranslate"><span class="pre">Instrument</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.Instrument.add_header_info"><code class="docutils literal notranslate"><span class="pre">Instrument.add_header_info()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.Instrument.apply_filters"><code class="docutils literal notranslate"><span class="pre">Instrument.apply_filters()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.Instrument.find_files"><code class="docutils literal notranslate"><span class="pre">Instrument.find_files()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.Instrument.get"><code class="docutils literal notranslate"><span class="pre">Instrument.get()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.Instrument.get_expected_values"><code class="docutils literal notranslate"><span class="pre">Instrument.get_expected_values()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.Instrument.get_extension"><code class="docutils literal notranslate"><span class="pre">Instrument.get_extension()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.Instrument.get_mask_filename"><code class="docutils literal notranslate"><span class="pre">Instrument.get_mask_filename()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.Instrument.get_supported_modes"><code class="docutils literal notranslate"><span class="pre">Instrument.get_supported_modes()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.Instrument.get_wavecal_filename"><code class="docutils literal notranslate"><span class="pre">Instrument.get_wavecal_filename()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.Instrument.get_wavelength_range"><code class="docutils literal notranslate"><span class="pre">Instrument.get_wavelength_range()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.Instrument.info"><code class="docutils literal notranslate"><span class="pre">Instrument.info</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.Instrument.load_fits"><code class="docutils literal notranslate"><span class="pre">Instrument.load_fits()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.Instrument.load_info"><code class="docutils literal notranslate"><span class="pre">Instrument.load_info()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.Instrument.name"><code class="docutils literal notranslate"><span class="pre">Instrument.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.Instrument.populate_filters"><code class="docutils literal notranslate"><span class="pre">Instrument.populate_filters()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.Instrument.sort_files"><code class="docutils literal notranslate"><span class="pre">Instrument.sort_files()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.InstrumentWithModes"><code class="docutils literal notranslate"><span class="pre">InstrumentWithModes</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.InstrumentWithModes.get_expected_values"><code class="docutils literal notranslate"><span class="pre">InstrumentWithModes.get_expected_values()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.create_custom_instrument"><code class="docutils literal notranslate"><span class="pre">create_custom_instrument()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.find_first_index"><code class="docutils literal notranslate"><span class="pre">find_first_index()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.getter"><code class="docutils literal notranslate"><span class="pre">getter</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.getter.get"><code class="docutils literal notranslate"><span class="pre">getter.get()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.observation_date_to_night"><code class="docutils literal notranslate"><span class="pre">observation_date_to_night()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="pyreduce.instruments.html#module-pyreduce.instruments.harps">pyreduce.instruments.harps module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.harps.FiberFilter"><code class="docutils literal notranslate"><span class="pre">FiberFilter</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.harps.FiberFilter.collect"><code class="docutils literal notranslate"><span class="pre">FiberFilter.collect()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.harps.HARPS"><code class="docutils literal notranslate"><span class="pre">HARPS</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.harps.HARPS.add_header_info"><code class="docutils literal notranslate"><span class="pre">HARPS.add_header_info()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.harps.HARPS.get_expected_values"><code class="docutils literal notranslate"><span class="pre">HARPS.get_expected_values()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.harps.HARPS.get_extension"><code class="docutils literal notranslate"><span class="pre">HARPS.get_extension()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.harps.HARPS.get_wavecal_filename"><code class="docutils literal notranslate"><span class="pre">HARPS.get_wavecal_filename()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.harps.HARPS.get_wavelength_range"><code class="docutils literal notranslate"><span class="pre">HARPS.get_wavelength_range()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.harps.PolarizationFilter"><code class="docutils literal notranslate"><span class="pre">PolarizationFilter</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.harps.PolarizationFilter.collect"><code class="docutils literal notranslate"><span class="pre">PolarizationFilter.collect()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.harps.TypeFilter"><code class="docutils literal notranslate"><span class="pre">TypeFilter</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.harps.TypeFilter.classify"><code class="docutils literal notranslate"><span class="pre">TypeFilter.classify()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="pyreduce.instruments.html#module-pyreduce.instruments.instrument_info">pyreduce.instruments.instrument_info module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.instrument_info.get_instrument_info"><code class="docutils literal notranslate"><span class="pre">get_instrument_info()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.instrument_info.get_supported_modes"><code class="docutils literal notranslate"><span class="pre">get_supported_modes()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.instrument_info.get_wavecal_filename"><code class="docutils literal notranslate"><span class="pre">get_wavecal_filename()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.instrument_info.load_instrument"><code class="docutils literal notranslate"><span class="pre">load_instrument()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.instrument_info.modeinfo"><code class="docutils literal notranslate"><span class="pre">modeinfo()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.instrument_info.sort_files"><code class="docutils literal notranslate"><span class="pre">sort_files()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="pyreduce.instruments.html#module-pyreduce.instruments.uves">pyreduce.instruments.uves module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.uves.UVES"><code class="docutils literal notranslate"><span class="pre">UVES</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.uves.UVES.add_header_info"><code class="docutils literal notranslate"><span class="pre">UVES.add_header_info()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.uves.UVES.get_mask_filename"><code class="docutils literal notranslate"><span class="pre">UVES.get_mask_filename()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.uves.UVES.get_wavecal_filename"><code class="docutils literal notranslate"><span class="pre">UVES.get_wavecal_filename()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="pyreduce.instruments.html#module-pyreduce.instruments">Module contents</a></li>
</ul>
</li>
</ul>
</div>
</section>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Link to this heading">¶</a></h2>
</section>
<section id="module-pyreduce.clipnflip">
<span id="pyreduce-clipnflip-module"></span><h2>pyreduce.clipnflip module<a class="headerlink" href="#module-pyreduce.clipnflip" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>Module that</dt><dd><ul class="simple">
<li><p>Clips remove pre- and overscan regions</p></li>
<li><p>Flips orients the image so that orders are roughly horizontal</p></li>
</ul>
</dd>
</dl>
<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.clipnflip.clipnflip">
<span class="sig-prename descclassname"><span class="pre">pyreduce.clipnflip.</span></span><span class="sig-name descname"><span class="pre">clipnflip</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">header</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xrange</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">yrange</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orientation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transpose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/clipnflip.html#clipnflip"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.clipnflip.clipnflip" title="Link to this definition">¶</a></dt>
<dd><p>Process an image and associated FITS header already in memory as follows:
1. Trim image to desired subregion: newimage = image(xlo:xhi,ylo:yhi)
2. Transform to standard orientation (red at top, orders run left to right)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>array</em><em>[</em><em>nrow</em><em>, </em><em>ncol</em><em>]</em>) – raw image to be processed.</p></li>
<li><p><strong>header</strong> (<em>fits.header</em><em>, </em><em>dict</em>) – FITS header of the image</p></li>
<li><p><strong>xrange</strong> (<em>tuple</em><em>(</em><em>int</em><em>, </em><em>int</em><em>)</em><em>, </em><em>optional</em>) – column - range to keep in the image (default: data from header/instrument)</p></li>
<li><p><strong>yrange</strong> (<em>tuple</em><em>(</em><em>int</em><em>, </em><em>int</em><em>)</em><em>, </em><em>optional</em>) – row - range to keep in the image (default: data from header/instrument)</p></li>
<li><p><strong>orientation</strong> (<em>int</em><em>, </em><em>optional</em>) – number of counterclockwise 90 degrees rotation to apply to the image (default: data from header/instrument)</p></li>
<li><p><strong>transpose</strong> (<em>bool</em><em>, </em><em>optional</em>) – if True the image will be transposed before rotation (default: data from header/instrument)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>image</strong> – clipped and flipped image</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array[yrange, xrange]</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>NotImplementedError</strong> – nonlinear images are not supported yet</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-pyreduce.combine_frames">
<span id="pyreduce-combine-frames-module"></span><h2>pyreduce.combine_frames module<a class="headerlink" href="#module-pyreduce.combine_frames" title="Link to this heading">¶</a></h2>
<p>Combine several fits files into one master frame</p>
<p>Used to create master bias and master flat</p>
<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.combine_frames.calculate_probability">
<span class="sig-prename descclassname"><span class="pre">pyreduce.combine_frames.</span></span><span class="sig-name descname"><span class="pre">calculate_probability</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">buffer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'sum'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/combine_frames.html#calculate_probability"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.combine_frames.calculate_probability" title="Link to this definition">¶</a></dt>
<dd><p>Construct a probability function based on buffer data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>buffer</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nx</em><em>, </em><em>ny</em><em>)</em>) – buffer</p></li>
<li><p><strong>window</strong> (<em>int</em>) – size of the running window</p></li>
<li><p><strong>method</strong> (<em>{&quot;sum&quot;</em><em>, </em><em>&quot;median&quot;}</em><em>, </em><em>optional</em>) – which method to use to average the probabilities (default: “sum”)
“sum” is much faster, but “median” is more resistant to outliers</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>weights</strong> – probabilities</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array of shape (nx, ny - 2 * window)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.combine_frames.combine_bias">
<span class="sig-prename descclassname"><span class="pre">pyreduce.combine_frames.</span></span><span class="sig-name descname"><span class="pre">combine_bias</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">instrument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extension</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">science_observation_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/combine_frames.html#combine_bias"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.combine_frames.combine_bias" title="Link to this definition">¶</a></dt>
<dd><p>Combine bias frames, determine read noise, reject bad pixels.
Read noise calculation only valid if both lists yield similar noise.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>files</strong> (<em>list</em><em>(</em><em>str</em><em>)</em>) – bias files to combine</p></li>
<li><p><strong>instrument</strong> (<em>str</em>) – instrument mode for modinfo</p></li>
<li><p><strong>extension</strong> (<em>{int</em><em>, </em><em>str}</em><em>, </em><em>optional</em>) – fits extension to use (default: 1)</p></li>
<li><p><strong>xr</strong> (<em>2-tuple</em><em>(</em><em>int</em><em>)</em><em>, </em><em>optional</em>) – x range to use (default: None, i.e. whole image)</p></li>
<li><p><strong>yr</strong> (<em>2-tuple</em><em>(</em><em>int</em><em>)</em><em>, </em><em>optional</em>) – y range to use (default: None, i.e. whole image)</p></li>
<li><p><strong>dtype</strong> (<em>np.dtype</em><em>, </em><em>optional</em>) – datatype of the combined bias frame (default: float32)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>bias image and header</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bias, bhead</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.combine_frames.combine_calibrate">
<span class="sig-prename descclassname"><span class="pre">pyreduce.combine_frames.</span></span><span class="sig-name descname"><span class="pre">combine_calibrate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">instrument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bhead</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias_scaling</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'exposure_time'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm_scaling</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'divide'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/combine_frames.html#combine_calibrate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.combine_frames.combine_calibrate" title="Link to this definition">¶</a></dt>
<dd><p>Combine the input files and then calibrate the image with the bias
and normalized flat field if provided</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>files</strong> (<em>list</em>) – list of file names to load</p></li>
<li><p><strong>instrument</strong> (<a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.Instrument" title="pyreduce.instruments.common.Instrument"><em>Instrument</em></a>) – PyReduce instrument object with load_fits method</p></li>
<li><p><strong>mode</strong> (<em>str</em>) – descriptor of the instrument mode</p></li>
<li><p><strong>mask</strong> (<em>array</em>) – 2D Bad Pixel Mask to apply to the master image</p></li>
<li><p><strong>bias</strong> (<em>tuple</em><em>(</em><em>bias</em><em>, </em><em>bhead</em><em>)</em><em>, </em><em>optional</em>) – bias correction to apply to the combiend image, if bias has 3 dimensions
it is used as polynomial coefficients scaling with the exposure time, by default None</p></li>
<li><p><strong>norm_flat</strong> (<em>tuple</em><em>(</em><em>norm</em><em>, </em><em>blaze</em><em>)</em><em>, </em><em>optional</em>) – normalized flat to divide the combined image with after
the bias subtraction, by default None</p></li>
<li><p><strong>bias_scaling</strong> (<em>str</em><em>, </em><em>optional</em>) – defines how the bias is subtracted, by default “exposure_time”</p></li>
<li><p><strong>plot</strong> (<em>bool</em><em>, </em><em>optional</em>) – whether to plot the results, by default False</p></li>
<li><p><strong>plot_title</strong> (<em>str</em><em>, </em><em>optional</em>) – Name to put on the plot, by default None</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>orig</strong> (<em>array</em>) – combined image with calibrations applied</p></li>
<li><p><strong>thead</strong> (<em>Header</em>) – header of the combined image</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – Unrecognised bias_scaling option</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.combine_frames.combine_frames">
<span class="sig-prename descclassname"><span class="pre">pyreduce.combine_frames.</span></span><span class="sig-name descname"><span class="pre">combine_frames</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">instrument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extension=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold=3.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window=50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype=&lt;class</span> <span class="pre">'numpy.float32'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/combine_frames.html#combine_frames"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.combine_frames.combine_frames" title="Link to this definition">¶</a></dt>
<dd><p>Subroutine to correct cosmic rays blemishes, while adding otherwise
similar images.</p>
<p>combine_frames co-adds a group of FITS files with 2D images of identical dimensions.
In the process it rejects cosmic ray, detector defects etc. It is capable of
handling images that have strip pattern (e.g. echelle spectra) using the REDUCE
modinfo conventions to figure out image orientation and useful pixel ranges.
It can handle many frames. Special cases: 1 file in the list (the input is returned as output)
and 2 files (straight sum is returned).</p>
<p>If the image orientation is not predominantly vertical, the image is rotated 90 degrees (and rotated back afterwards).</p>
<p>Open all FITS files in the list.
Loop through the rows. Read next row from each file into a row buffer mBuff[nCol, nFil].
Optionally correct the data for non-linearity.</p>
<p>calc_probability:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Go through the row creating &quot;probability&quot; vector. That is for column iCol take the median of
the part of the row mBuff[iCol-win:iCol+win,iFil] for each file and divide these medians by the
mean of them computed across the stack of files. In other words:
&gt;&gt;&gt; filwt[iFil] = median(mBuff[iCol-win:iCol+win,iFil])
&gt;&gt;&gt; norm_filwt = mean(filwt)
&gt;&gt;&gt; prob[iCol,iFil] = (norm_filtwt&gt;0)?filwt[iCol]/norm_filwt:filwt[iCol]

This is done for all iCol in the range of [win:nCol-win-1]. It is then linearly extrapolated to
the win zones of both ends. E.g. for iCol in [0:win-1] range:
&gt;&gt;&gt; prob[iCol,iFil]=2*prob[win,iFil]-prob[2*win-iCol,iFil]

For the other end ([nCol-win:nCol-1]) it is similar:
&gt;&gt;&gt; prob[iCol,iFil]=2*prob[nCol-win-1,iFil]-prob[2*(nCol-win-1)-iCol,iFil]
</pre></div>
</div>
<p>fix_bad_pixels:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Once</span> <span class="n">the</span> <span class="n">probailities</span> <span class="n">are</span> <span class="n">constructed</span> <span class="n">we</span> <span class="n">can</span> <span class="n">do</span> <span class="n">the</span> <span class="n">fitting</span><span class="p">,</span> <span class="n">measure</span> <span class="n">scatter</span> <span class="ow">and</span> <span class="n">detect</span> <span class="n">outliers</span><span class="o">.</span>
<span class="n">We</span> <span class="n">ignore</span> <span class="n">negative</span> <span class="ow">or</span> <span class="n">zero</span> <span class="n">probabilities</span> <span class="k">as</span> <span class="n">it</span> <span class="n">should</span> <span class="ow">not</span> <span class="n">happen</span><span class="o">.</span> <span class="n">For</span> <span class="n">each</span> <span class="n">iCol</span> <span class="k">with</span> <span class="p">(</span><span class="n">some</span><span class="p">)</span>
<span class="n">positive</span> <span class="n">probabilities</span> <span class="n">we</span> <span class="n">compute</span> <span class="n">tha</span> <span class="n">ratios</span> <span class="n">of</span> <span class="n">the</span> <span class="n">original</span> <span class="n">data</span> <span class="n">to</span> <span class="n">the</span> <span class="n">probabilities</span> <span class="ow">and</span> <span class="n">get</span>
<span class="n">the</span> <span class="n">mean</span> <span class="n">amplitude</span> <span class="n">of</span> <span class="n">these</span> <span class="n">ratios</span> <span class="n">after</span> <span class="n">rejecting</span> <span class="n">extreme</span> <span class="n">values</span><span class="p">:</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ratio</span> <span class="o">=</span> <span class="n">mBuff</span><span class="p">[</span><span class="n">iCol</span><span class="p">,</span><span class="n">iFil</span><span class="p">]</span><span class="o">/</span><span class="n">prob</span><span class="p">[</span><span class="n">iCol</span><span class="p">,</span><span class="n">iFil</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">amp</span> <span class="o">=</span> <span class="p">(</span><span class="n">total</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span><span class="o">-</span><span class="nb">max</span><span class="p">(</span><span class="n">ratio</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">nFil</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mFit</span><span class="p">[</span><span class="n">iCol</span><span class="p">,</span><span class="n">iFil</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span><span class="o">*</span><span class="n">prob</span><span class="p">[</span><span class="n">iCol</span><span class="p">,</span><span class="n">iFil</span><span class="p">]</span>

<span class="n">Note</span> <span class="n">that</span> <span class="k">for</span> <span class="n">iFil</span> <span class="n">whereprob</span><span class="p">[</span><span class="n">iCol</span><span class="p">,</span><span class="n">iFil</span><span class="p">]</span> <span class="ow">is</span> <span class="n">zero</span> <span class="n">we</span> <span class="n">simply</span> <span class="nb">set</span> <span class="n">mFit</span> <span class="n">to</span> <span class="n">zero</span><span class="o">.</span> <span class="n">The</span> <span class="n">scatter</span> <span class="p">(</span><span class="n">noise</span><span class="p">)</span>
<span class="n">consists</span> <span class="n">readout</span> <span class="n">noise</span> <span class="ow">and</span> <span class="n">shot</span> <span class="n">noise</span> <span class="n">of</span> <span class="n">the</span> <span class="n">model</span> <span class="p">(</span><span class="n">fit</span><span class="p">)</span> <span class="n">co</span><span class="o">-</span><span class="n">added</span> <span class="ow">in</span> <span class="n">quadratures</span><span class="p">:</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sig</span><span class="o">=</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rdnoise</span><span class="o">*</span><span class="n">rdnoise</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mFit</span><span class="p">[</span><span class="n">iCol</span><span class="p">,</span><span class="n">iFil</span><span class="p">]</span><span class="o">/</span><span class="n">gain</span><span class="p">))</span>

<span class="ow">and</span> <span class="n">the</span> <span class="n">outliers</span> <span class="n">are</span> <span class="n">defined</span> <span class="k">as</span><span class="p">:</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">iBad</span><span class="o">=</span><span class="n">where</span><span class="p">(</span><span class="n">mBuff</span><span class="o">-</span><span class="n">mFit</span> <span class="n">gt</span> <span class="n">thresh</span><span class="o">*</span><span class="n">sig</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">Bad</span> <span class="n">values</span> <span class="n">are</span> <span class="n">replaced</span> <span class="kn">from</span><span class="w"> </span><span class="nn">the</span> <span class="n">fit</span><span class="p">:</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mBuff</span><span class="p">[</span><span class="n">iBad</span><span class="p">]</span><span class="o">=</span><span class="n">mFit</span><span class="p">[</span><span class="n">iBad</span><span class="p">]</span>

<span class="ow">and</span> <span class="n">mBuff</span> <span class="ow">is</span> <span class="n">summed</span> <span class="n">across</span> <span class="n">the</span> <span class="n">file</span> <span class="n">dimension</span> <span class="n">to</span> <span class="n">create</span> <span class="n">an</span> <span class="n">output</span> <span class="n">row</span><span class="o">.</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>files</strong> (<em>list</em><em>(</em><em>str</em><em>)</em>) – list of fits files to combine</p></li>
<li><p><strong>instrument</strong> (<em>str</em>) – instrument id for modinfo</p></li>
<li><p><strong>mode</strong> (<em>str</em>) – instrument mode</p></li>
<li><p><strong>extension</strong> (<em>int</em><em>, </em><em>optional</em>) – fits extension to load (default: 1)</p></li>
<li><p><strong>threshold</strong> (<em>float</em><em>, </em><em>optional</em>) – threshold for bad pixels (default: 3.5)</p></li>
<li><p><strong>window</strong> (<em>int</em><em>, </em><em>optional</em>) – horizontal window size (default: 50)</p></li>
<li><p><strong>mask</strong> (<em>array</em><em>(</em><em>bool</em><em>)</em><em>, </em><em>optional</em>) – mask for the fits image (default: None)</p></li>
<li><p><strong>xr</strong> (<em>int</em><em>, </em><em>optional</em>) – xrange (default: None)</p></li>
<li><p><strong>yr</strong> (<em>int</em><em>, </em><em>optional</em>) – yrange (default: None)</p></li>
<li><p><strong>debug</strong> (<em>bool</em><em>, </em><em>optional</em>) – show debug plot of noise distribution (default: False)</p></li>
<li><p><strong>dtype</strong> (<em>np.dtype</em><em>, </em><em>optional</em>) – datatype of the combined image (default float32)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>combined image data, header</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>combined_data, header</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.combine_frames.combine_frames_simple">
<span class="sig-prename descclassname"><span class="pre">pyreduce.combine_frames.</span></span><span class="sig-name descname"><span class="pre">combine_frames_simple</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">instrument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extension=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype=&lt;class</span> <span class="pre">'numpy.float32'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/combine_frames.html#combine_frames_simple"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.combine_frames.combine_frames_simple" title="Link to this definition">¶</a></dt>
<dd><p>Simple addition of similar images.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>files</strong> (<em>list</em><em>(</em><em>str</em><em>)</em>) – list of fits files to combine</p></li>
<li><p><strong>instrument</strong> (<em>str</em>) – instrument id for modinfo</p></li>
<li><p><strong>mode</strong> (<em>str</em>) – instrument mode</p></li>
<li><p><strong>extension</strong> (<em>int</em><em>, </em><em>optional</em>) – fits extension to load (default: 1)</p></li>
<li><p><strong>dtype</strong> (<em>np.dtype</em><em>, </em><em>optional</em>) – datatype of the combined image (default float32)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>combined image data, header</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>combined_data, header</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.combine_frames.combine_polynomial">
<span class="sig-prename descclassname"><span class="pre">pyreduce.combine_frames.</span></span><span class="sig-name descname"><span class="pre">combine_polynomial</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">instrument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/combine_frames.html#combine_polynomial"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.combine_frames.combine_polynomial" title="Link to this definition">¶</a></dt>
<dd><p>Combine the input files by fitting a polynomial of the pixel value versus
the exposure time of each pixel</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>files</strong> (<em>list</em>) – list of file names</p></li>
<li><p><strong>instrument</strong> (<a class="reference internal" href="pyreduce.instruments.html#pyreduce.instruments.common.Instrument" title="pyreduce.instruments.common.Instrument"><em>Instrument</em></a>) – PyReduce instrument object with load_fits method</p></li>
<li><p><strong>mode</strong> (<em>str</em>) – mode identifier for this instrument</p></li>
<li><p><strong>mask</strong> (<em>array</em>) – bad pixel mask to apply to the coefficients</p></li>
<li><p><strong>degree</strong> (<em>int</em><em>, </em><em>optional</em>) – polynomial degree of the fit, by default 1</p></li>
<li><p><strong>plot</strong> (<em>bool</em><em>, </em><em>optional</em>) – whether to plot the results, by default False</p></li>
<li><p><strong>plot_title</strong> (<em>str</em><em>, </em><em>optional</em>) – Title of the plot, by default None</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>bias</strong> (<em>array</em>) – 3d array with the coefficients for each pixel</p></li>
<li><p><strong>bhead</strong> (<em>Header</em>) – combined FITS header of the coefficients</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.combine_frames.fix_bad_pixels">
<span class="sig-prename descclassname"><span class="pre">pyreduce.combine_frames.</span></span><span class="sig-name descname"><span class="pre">fix_bad_pixels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">probability</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buffer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">readnoise</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gain</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/combine_frames.html#fix_bad_pixels"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.combine_frames.fix_bad_pixels" title="Link to this definition">¶</a></dt>
<dd><p>find and fix bad pixels</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>probability</strong> (<em>array</em><em>(</em><em>float</em><em>)</em>) – probabilities</p></li>
<li><p><strong>buffer</strong> (<em>array</em><em>(</em><em>int</em><em>)</em>) – image buffer</p></li>
<li><p><strong>readnoise</strong> (<em>float</em>) – readnoise of current amplifier</p></li>
<li><p><strong>gain</strong> (<em>float</em>) – gain of current amplifier</p></li>
<li><p><strong>threshold</strong> (<em>float</em>) – sigma threshold between observation and fit for bad pixels</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>input buffer, with bad pixels fixed</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array(int)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.combine_frames.running_median">
<span class="sig-prename descclassname"><span class="pre">pyreduce.combine_frames.</span></span><span class="sig-name descname"><span class="pre">running_median</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/combine_frames.html#running_median"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.combine_frames.running_median" title="Link to this definition">¶</a></dt>
<dd><p>Calculate the running median of a 2D sequence</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>seq</strong> (<em>2d array</em><em> [</em><em>n</em><em>, </em><em>l</em><em>]</em>) – n datasets of length l</p></li>
<li><p><strong>size</strong> (<em>int</em>) – number of elements to consider for each median</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>running median</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>2d array [n, l-size]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.combine_frames.running_sum">
<span class="sig-prename descclassname"><span class="pre">pyreduce.combine_frames.</span></span><span class="sig-name descname"><span class="pre">running_sum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/combine_frames.html#running_sum"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.combine_frames.running_sum" title="Link to this definition">¶</a></dt>
<dd><p>Calculate the running sum over the 2D sequence</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>arr</strong> (<em>array</em><em>[</em><em>n</em><em>, </em><em>l</em><em>]</em>) – sequence to calculate running sum over, n datasets of length l</p></li>
<li><p><strong>size</strong> (<em>int</em>) – number of elements to sum</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>running sum</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>2D array</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-pyreduce.continuum_normalization">
<span id="pyreduce-continuum-normalization-module"></span><h2>pyreduce.continuum_normalization module<a class="headerlink" href="#module-pyreduce.continuum_normalization" title="Link to this heading">¶</a></h2>
<p>Find the continuum level</p>
<p>Currently only splices orders together
First guess of the continuum is provided by the flat field</p>
<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.continuum_normalization.Plot_Normalization">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.continuum_normalization.</span></span><span class="sig-name descname"><span class="pre">Plot_Normalization</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wsort</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sB</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_wave</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contB</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iteration</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/continuum_normalization.html#Plot_Normalization"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.continuum_normalization.Plot_Normalization" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.continuum_normalization.Plot_Normalization.close">
<span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/continuum_normalization.html#Plot_Normalization.close"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.continuum_normalization.Plot_Normalization.close" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.continuum_normalization.Plot_Normalization.plot">
<span class="sig-name descname"><span class="pre">plot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wsort</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sB</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_wave</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contB</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iteration</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/continuum_normalization.html#Plot_Normalization.plot"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.continuum_normalization.Plot_Normalization.plot" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.continuum_normalization.continuum_normalize">
<span class="sig-prename descclassname"><span class="pre">pyreduce.continuum_normalization.</span></span><span class="sig-name descname"><span class="pre">continuum_normalize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wave</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cont</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smooth_initial</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smooth_final</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5000000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale_vert</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/continuum_normalization.html#continuum_normalize"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.continuum_normalization.continuum_normalize" title="Link to this definition">¶</a></dt>
<dd><p>Fit a continuum to a spectrum by slowly approaching it from the top.
We exploit here that the continuum varies only on large wavelength scales, while individual lines act on much smaller scales</p>
<p>TODO automatically find good parameters for smooth_initial and smooth_final
TODO give variables better names</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>spec</strong> (<em>masked array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em>) – Observed input spectrum, masked values describe column ranges</p></li>
<li><p><strong>wave</strong> (<em>masked array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em>) – Wavelength solution of the spectrum</p></li>
<li><p><strong>cont</strong> (<em>masked array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em>) – Initial continuum guess, for example based on the blaze</p></li>
<li><p><strong>sigm</strong> (<em>masked array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em>) – Uncertainties of the spectrum</p></li>
<li><p><strong>iterations</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of iterations of the algorithm,
note that runtime roughly scales with the number of iterations squared
(default: 10)</p></li>
<li><p><strong>smooth_initial</strong> (<em>float</em><em>, </em><em>optional</em>) – Smoothing parameter in the initial runs, usually smaller than smooth_final (default: 1e5)</p></li>
<li><p><strong>smooth_final</strong> (<em>float</em><em>, </em><em>optional</em>) – Smoothing parameter of the final run (default: 5e6)</p></li>
<li><p><strong>scale_vert</strong> (<em>float</em><em>, </em><em>optional</em>) – Vertical scale of the spectrum. Usually 1 if a previous normalization exists (default: 1)</p></li>
<li><p><strong>plot</strong> (<em>bool</em><em>, </em><em>optional</em>) – Wether to plot the current status and results or not (default: True)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>cont</strong> – New continuum</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>masked array of shape (nord, ncol)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.continuum_normalization.splice_orders">
<span class="sig-prename descclassname"><span class="pre">pyreduce.continuum_normalization.</span></span><span class="sig-name descname"><span class="pre">splice_orders</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wave</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cont</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scaling</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/continuum_normalization.html#splice_orders"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.continuum_normalization.splice_orders" title="Link to this definition">¶</a></dt>
<dd><p>Splice orders together so that they form a continous spectrum
This is achieved by linearly combining the overlaping regions</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>spec</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>ncol</em><em>]</em>) – Spectrum to splice, with seperate orders</p></li>
<li><p><strong>wave</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>ncol</em><em>]</em>) – Wavelength solution for each point</p></li>
<li><p><strong>cont</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>ncol</em><em>]</em>) – Continuum, blaze function will do fine as well</p></li>
<li><p><strong>sigm</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>ncol</em><em>]</em>) – Errors on the spectrum</p></li>
<li><p><strong>scaling</strong> (<em>bool</em><em>, </em><em>optional</em>) – If true, the spectrum/continuum will be scaled to 1 (default: False)</p></li>
<li><p><strong>plot</strong> (<em>bool</em><em>, </em><em>optional</em>) – If true, will plot the spliced spectrum (default: False)</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>NotImplementedError</strong> – If neighbouring orders dont overlap</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>spec, wave, cont, sigm</strong> – spliced spectrum</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>array[nord, ncol]</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-pyreduce.cwrappers">
<span id="pyreduce-cwrappers-module"></span><h2>pyreduce.cwrappers module<a class="headerlink" href="#module-pyreduce.cwrappers" title="Link to this heading">¶</a></h2>
<p>Wrapper for REDUCE C functions</p>
<p>This module provides access to the extraction algorithms in the
C libraries and sanitizes the input parameters.</p>
<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.cwrappers.create_spectral_model">
<span class="sig-prename descclassname"><span class="pre">pyreduce.cwrappers.</span></span><span class="sig-name descname"><span class="pre">create_spectral_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">ncols:</span> <span class="pre">int,</span> <span class="pre">nrows:</span> <span class="pre">int,</span> <span class="pre">osample:</span> <span class="pre">int,</span> <span class="pre">xi:</span> <span class="pre">[('x',</span> <span class="pre">&lt;class</span> <span class="pre">'ctypes.c_int'&gt;),</span> <span class="pre">('y',</span> <span class="pre">&lt;class</span> <span class="pre">'ctypes.c_int'&gt;),</span> <span class="pre">('w',</span> <span class="pre">&lt;class</span> <span class="pre">'ctypes.c_double'&gt;)],</span> <span class="pre">spec:</span> <span class="pre">~numpy.ndarray,</span> <span class="pre">slitfunc:</span> <span class="pre">~numpy.ndarray</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/cwrappers.html#create_spectral_model"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.cwrappers.create_spectral_model" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.cwrappers.slitfunc">
<span class="sig-prename descclassname"><span class="pre">pyreduce.cwrappers.</span></span><span class="sig-name descname"><span class="pre">slitfunc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ycen</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lambda_sp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lambda_sf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">osample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/cwrappers.html#slitfunc"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.cwrappers.slitfunc" title="Link to this definition">¶</a></dt>
<dd><p>Decompose image into spectrum and slitfunction</p>
<p>This is for horizontal straight orders only, for curved orders use slitfunc_curved instead</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<em>array</em><em>[</em><em>n</em><em>, </em><em>m</em><em>]</em>) – image to decompose, should just contain a small part of the overall image</p></li>
<li><p><strong>ycen</strong> (<em>array</em><em>[</em><em>n</em><em>]</em>) – traces the center of the order along the image, relative to the center of the image?</p></li>
<li><p><strong>lambda_sp</strong> (<em>float</em><em>, </em><em>optional</em>) – smoothing parameter of the spectrum (the default is 0, which no smoothing)</p></li>
<li><p><strong>lambda_sf</strong> (<em>float</em><em>, </em><em>optional</em>) – smoothing parameter of the slitfunction (the default is 0.1, which )</p></li>
<li><p><strong>osample</strong> (<em>int</em><em>, </em><em>optional</em>) – Subpixel ovsersampling factor (the default is 1, which no oversampling)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>spectrum, slitfunction, model, spectrum uncertainties</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>sp, sl, model, unc</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.cwrappers.slitfunc_curved">
<span class="sig-prename descclassname"><span class="pre">pyreduce.cwrappers.</span></span><span class="sig-name descname"><span class="pre">slitfunc_curved</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ycen</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tilt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shear</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lambda_sp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lambda_sf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">osample</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">yrange</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxiter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gain</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/cwrappers.html#slitfunc_curved"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.cwrappers.slitfunc_curved" title="Link to this definition">¶</a></dt>
<dd><p>Decompose an image into a spectrum and a slitfunction, image may be curved</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<em>array</em><em>[</em><em>n</em><em>, </em><em>m</em><em>]</em>) – input image</p></li>
<li><p><strong>ycen</strong> (<em>array</em><em>[</em><em>n</em><em>]</em>) – traces the center of the order</p></li>
<li><p><strong>tilt</strong> (<em>array</em><em>[</em><em>n</em><em>]</em>) – tilt (1st order curvature) of the order along the image, set to 0 if order straight</p></li>
<li><p><strong>shear</strong> (<em>array</em><em>[</em><em>n</em><em>]</em>) – shear (2nd order curvature) of the order along the image, set to 0 if order straight</p></li>
<li><p><strong>osample</strong> (<em>int</em>) – Subpixel ovsersampling factor (the default is 1, no oversampling)</p></li>
<li><p><strong>lambda_sp</strong> (<em>float</em>) – smoothing factor spectrum (the default is 0, no smoothing)</p></li>
<li><p><strong>lambda_sl</strong> (<em>float</em>) – smoothing factor slitfunction (the default is 0.1, small smoothing)</p></li>
<li><p><strong>yrange</strong> (<em>array</em><em>[</em><em>2</em><em>]</em>) – number of pixels below and above the central line that have been cut out</p></li>
<li><p><strong>maxiter</strong> (<em>int</em><em>, </em><em>optional</em>) – maximumim number of iterations, by default 20</p></li>
<li><p><strong>gain</strong> (<em>float</em><em>, </em><em>optional</em>) – gain of the image, by default 1</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>spectrum, slitfunction, model, spectrum uncertainties</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>sp, sl, model, unc</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.cwrappers.xi_zeta_tensors">
<span class="sig-prename descclassname"><span class="pre">pyreduce.cwrappers.</span></span><span class="sig-name descname"><span class="pre">xi_zeta_tensors</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ncols</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nrows</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ycen</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">yrange</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">osample</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tilt</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shear</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/cwrappers.html#xi_zeta_tensors"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.cwrappers.xi_zeta_tensors" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-pyreduce.datasets">
<span id="pyreduce-datasets-module"></span><h2>pyreduce.datasets module<a class="headerlink" href="#module-pyreduce.datasets" title="Link to this heading">¶</a></h2>
<p>Provides example datasets for the examples</p>
<p>This requires the server to be up and running,
if data needs to be downloaded</p>
<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.datasets.HARPS">
<span class="sig-prename descclassname"><span class="pre">pyreduce.datasets.</span></span><span class="sig-name descname"><span class="pre">HARPS</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">local_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/datasets.html#HARPS"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.datasets.HARPS" title="Link to this definition">¶</a></dt>
<dd><p>Load an example dataset
instrument: HARPS
target: HD109200</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>local_dir</strong> (<em>str</em><em>, </em><em>optional</em>) – directory to save data at (default: “./”)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>dataset_dir</strong> – directory where the data was saved</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.datasets.JWST_MIRI">
<span class="sig-prename descclassname"><span class="pre">pyreduce.datasets.</span></span><span class="sig-name descname"><span class="pre">JWST_MIRI</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">local_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/datasets.html#JWST_MIRI"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.datasets.JWST_MIRI" title="Link to this definition">¶</a></dt>
<dd><p>Load an example dataset
instrument: JWST_MIRI
target: ?</p>
<p>Data simulated with MIRIsim</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>local_dir</strong> (<em>str</em><em>, </em><em>optional</em>) – directory to save data at (default: “./”)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>dataset_dir</strong> – directory where the data was saved</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.datasets.JWST_NIRISS">
<span class="sig-prename descclassname"><span class="pre">pyreduce.datasets.</span></span><span class="sig-name descname"><span class="pre">JWST_NIRISS</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">local_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/datasets.html#JWST_NIRISS"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.datasets.JWST_NIRISS" title="Link to this definition">¶</a></dt>
<dd><p>Load an example dataset
instrument: JWST_NIRISS
target: ?</p>
<p>Data simulated with awesimsoss</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>local_dir</strong> (<em>str</em><em>, </em><em>optional</em>) – directory to save data at (default: “./”)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>dataset_dir</strong> – directory where the data was saved</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.datasets.KECK_NIRSPEC">
<span class="sig-prename descclassname"><span class="pre">pyreduce.datasets.</span></span><span class="sig-name descname"><span class="pre">KECK_NIRSPEC</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">local_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/datasets.html#KECK_NIRSPEC"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.datasets.KECK_NIRSPEC" title="Link to this definition">¶</a></dt>
<dd><p>Load an example dataset
instrument: KECK_NIRSPEC
target: GJ1214</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>local_dir</strong> (<em>str</em><em>, </em><em>optional</em>) – directory to save data at (default: “./”)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>dataset_dir</strong> – directory where the data was saved</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.datasets.LICK_APF">
<span class="sig-prename descclassname"><span class="pre">pyreduce.datasets.</span></span><span class="sig-name descname"><span class="pre">LICK_APF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">local_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/datasets.html#LICK_APF"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.datasets.LICK_APF" title="Link to this definition">¶</a></dt>
<dd><p>Load an example dataset
instrument: LICK_APF
target: KIC05005618</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>local_dir</strong> (<em>str</em><em>, </em><em>optional</em>) – directory to save data at (default: “./”)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>dataset_dir</strong> – directory where the data was saved</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.datasets.MCDONALD">
<span class="sig-prename descclassname"><span class="pre">pyreduce.datasets.</span></span><span class="sig-name descname"><span class="pre">MCDONALD</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">local_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/datasets.html#MCDONALD"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.datasets.MCDONALD" title="Link to this definition">¶</a></dt>
<dd><p>Load an example dataset
instrument: JWST_MIRI
target: ?</p>
<p>Data simulated with MIRIsim</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>local_dir</strong> (<em>str</em><em>, </em><em>optional</em>) – directory to save data at (default: “./”)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>dataset_dir</strong> – directory where the data was saved</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.datasets.UVES">
<span class="sig-prename descclassname"><span class="pre">pyreduce.datasets.</span></span><span class="sig-name descname"><span class="pre">UVES</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">local_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/datasets.html#UVES"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.datasets.UVES" title="Link to this definition">¶</a></dt>
<dd><p>Load an example dataset
instrument: UVES
target: HD132205</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>local_dir</strong> (<em>str</em><em>, </em><em>optional</em>) – directory to save data at (default: “./”)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>dataset_dir</strong> – directory where the data was saved</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.datasets.XSHOOTER">
<span class="sig-prename descclassname"><span class="pre">pyreduce.datasets.</span></span><span class="sig-name descname"><span class="pre">XSHOOTER</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">local_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/datasets.html#XSHOOTER"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.datasets.XSHOOTER" title="Link to this definition">¶</a></dt>
<dd><p>Load an example dataset
instrument: XSHOOTER
target: Ux-Ori</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>local_dir</strong> (<em>str</em><em>, </em><em>optional</em>) – directory to save data at (default: “./”)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>dataset_dir</strong> – directory where the data was saved</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.datasets.get_dataset">
<span class="sig-prename descclassname"><span class="pre">pyreduce.datasets.</span></span><span class="sig-name descname"><span class="pre">get_dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">local_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/datasets.html#get_dataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.datasets.get_dataset" title="Link to this definition">¶</a></dt>
<dd><p>Load a dataset</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This method will not override existing files with the same
name, even if they have a different content. Therefore
if the files were changed for any reason, the user has to
manually delete them from the disk before using this method.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<em>str</em>) – Name of the dataset</p></li>
<li><p><strong>local_dir</strong> (<em>str</em><em>, </em><em>optional</em>) – directory to save data at (default: “./”)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>dataset_dir</strong> – directory where the data was saved</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.datasets.load_data_from_server">
<span class="sig-prename descclassname"><span class="pre">pyreduce.datasets.</span></span><span class="sig-name descname"><span class="pre">load_data_from_server</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">directory</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/datasets.html#load_data_from_server"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.datasets.load_data_from_server" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-pyreduce.echelle">
<span id="pyreduce-echelle-module"></span><h2>pyreduce.echelle module<a class="headerlink" href="#module-pyreduce.echelle" title="Link to this heading">¶</a></h2>
<p>Contains functions to read and modify echelle structures, just as in reduce</p>
<p>Mostly for compatibility reasons</p>
<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.echelle.Echelle">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.echelle.</span></span><span class="sig-name descname"><span class="pre">Echelle</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">head</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/echelle.html#Echelle"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.echelle.Echelle" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.echelle.Echelle.columns">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">columns</span></span><a class="headerlink" href="#pyreduce.echelle.Echelle.columns" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.echelle.Echelle.cont">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">cont</span></span><a class="headerlink" href="#pyreduce.echelle.Echelle.cont" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.echelle.Echelle.mask">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">mask</span></span><a class="headerlink" href="#pyreduce.echelle.Echelle.mask" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.echelle.Echelle.ncol">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">ncol</span></span><a class="headerlink" href="#pyreduce.echelle.Echelle.ncol" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.echelle.Echelle.nord">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">nord</span></span><a class="headerlink" href="#pyreduce.echelle.Echelle.nord" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.echelle.Echelle.read">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">read</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extension</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">continuum_normalization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">barycentric_correction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">radial_velociy_correction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/echelle.html#Echelle.read"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.echelle.Echelle.read" title="Link to this definition">¶</a></dt>
<dd><p>Read data from an echelle file
Expand wavelength and continuum polynomials
Apply barycentric/radial velocity correction
Apply continuum normalization</p>
<p>Will load any fields in the binary table, however special attention is given only to specific names:
“SPEC”    : Spectrum
“SIG”     : Sigma, i.e. (absolute) uncertainty
“CONT”    : Continuum
“WAVE”    : Wavelength solution
“COLUMNS” : Column range</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fname</strong> (<em>str</em>) – filename to load</p></li>
<li><p><strong>extension</strong> (<em>int</em><em>, </em><em>optional</em>) – fits extension of the data within the file (default: 1)</p></li>
<li><p><strong>raw</strong> (<em>bool</em><em>, </em><em>optional</em>) – if true apply no corrections to the data (default: False)</p></li>
<li><p><strong>continuum_normalization</strong> (<em>bool</em><em>, </em><em>optional</em>) – apply continuum normalization (default: True)</p></li>
<li><p><strong>barycentric_correction</strong> (<em>bool</em><em>, </em><em>optional</em>) – apply barycentric correction (default: True)</p></li>
<li><p><strong>radial_velociy_correction</strong> (<em>bool</em><em>, </em><em>optional</em>) – apply radial velocity correction (default: True)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ech</strong> – Echelle structure, with data contained in attributes</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>obj</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.echelle.Echelle.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fname</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/echelle.html#Echelle.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.echelle.Echelle.save" title="Link to this definition">¶</a></dt>
<dd><p>Save data in an Echelle fits, i.e. a fits file with a Binary Table in Extension 1</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>fname</strong> (<em>str</em>) – filename</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.echelle.Echelle.sig">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">sig</span></span><a class="headerlink" href="#pyreduce.echelle.Echelle.sig" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.echelle.Echelle.spec">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">spec</span></span><a class="headerlink" href="#pyreduce.echelle.Echelle.spec" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.echelle.Echelle.wave">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">wave</span></span><a class="headerlink" href="#pyreduce.echelle.Echelle.wave" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.echelle.calc_1dpolynomials">
<span class="sig-prename descclassname"><span class="pre">pyreduce.echelle.</span></span><span class="sig-name descname"><span class="pre">calc_1dpolynomials</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ncol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">poly</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/echelle.html#calc_1dpolynomials"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.echelle.calc_1dpolynomials" title="Link to this definition">¶</a></dt>
<dd><p>Expand a set of 1d polynomials (one per order) seperately</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ncol</strong> (<em>int</em>) – number of columns</p></li>
<li><p><strong>poly</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>degree</em><em>]</em>) – polynomial coefficients</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>poly</strong> – expanded polynomials</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array[nord, ncol]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.echelle.calc_2dpolynomial">
<span class="sig-prename descclassname"><span class="pre">pyreduce.echelle.</span></span><span class="sig-name descname"><span class="pre">calc_2dpolynomial</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">solution2d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/echelle.html#calc_2dpolynomial"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.echelle.calc_2dpolynomial" title="Link to this definition">¶</a></dt>
<dd><p>Expand a 2d polynomial, where the data is given in a REDUCE make_wave format
Note that the coefficients are for order/100 and column/1000 respectively, where the order is counted from order base up</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>solution2d</strong> (<em>array</em>) – data in a REDUCE make_wave format:
0: version
1: number of columns
2: number of orders
3: order base, i.e. 0th order number (should not be 0)
4-6: empty
7: number of cross coefficients
8: number of column only coefficients
9: number of order only coefficients
10: coefficient - constant
11-x: column coefficients
x-y : order coefficients
z-  : cross coefficients (xy, xy2, x2y, x2y2, xy3, x3y), with x = orders, y = columns</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>poly</strong> – expanded polynomial</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array[nord, ncol]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.echelle.expand_polynomial">
<span class="sig-prename descclassname"><span class="pre">pyreduce.echelle.</span></span><span class="sig-name descname"><span class="pre">expand_polynomial</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ncol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">poly</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/echelle.html#expand_polynomial"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.echelle.expand_polynomial" title="Link to this definition">¶</a></dt>
<dd><p>Checks if and how to expand data poly, then expands the data if necessary</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ncol</strong> (<em>int</em>) – number of columns in the image</p></li>
<li><p><strong>poly</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>...</em><em>]</em>) – polynomial coefficients to expand, or already expanded data</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>poly</strong> – expanded data</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array[nord, ncol]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.echelle.read">
<span class="sig-prename descclassname"><span class="pre">pyreduce.echelle.</span></span><span class="sig-name descname"><span class="pre">read</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fname</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/echelle.html#read"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.echelle.read" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.echelle.save">
<span class="sig-prename descclassname"><span class="pre">pyreduce.echelle.</span></span><span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">header</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/echelle.html#save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.echelle.save" title="Link to this definition">¶</a></dt>
<dd><p>Save data in an Echelle fits, i.e. a fits file with a Binary Table in Extension 1</p>
<p>The data is passed in kwargs, with the name of the binary table column as the key
Floating point data is saved as float32 (E), Integer data as int16 (I)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fname</strong> (<em>str</em>) – filename</p></li>
<li><p><strong>header</strong> (<em>fits.header</em>) – FITS header</p></li>
<li><p><strong>**kwargs</strong> (<em>array</em><em>[</em><em>]</em>) – data to be saved in the file</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-pyreduce.estimate_background_scatter">
<span id="pyreduce-estimate-background-scatter-module"></span><h2>pyreduce.estimate_background_scatter module<a class="headerlink" href="#module-pyreduce.estimate_background_scatter" title="Link to this heading">¶</a></h2>
<p>Module that estimates the background scatter</p>
<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.estimate_background_scatter.estimate_background_scatter">
<span class="sig-prename descclassname"><span class="pre">pyreduce.estimate_background_scatter.</span></span><span class="sig-name descname"><span class="pre">estimate_background_scatter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extraction_width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scatter_degree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma_cutoff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">border_width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/estimate_background_scatter.html#estimate_background_scatter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.estimate_background_scatter.estimate_background_scatter" title="Link to this definition">¶</a></dt>
<dd><p>Estimate the background by fitting a 2d polynomial to interorder data</p>
<p>Interorder data is all pixels minus the orders +- the extraction width</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<em>array</em><em>[</em><em>nrow</em><em>, </em><em>ncol</em><em>]</em>) – (flat) image data</p></li>
<li><p><strong>orders</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>degree</em><em>]</em>) – order polynomial coefficients</p></li>
<li><p><strong>column_range</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>2</em><em>]</em><em>, </em><em>optional</em>) – range of columns to use in each order (default: None == all columns)</p></li>
<li><p><strong>extraction_width</strong> (<em>float</em><em>, </em><em>array</em><em>[</em><em>nord</em><em>, </em><em>2</em><em>]</em><em>, </em><em>optional</em>) – extraction width for each order, values below 1.5 are considered fractional, others as number of pixels (default: 0.1)</p></li>
<li><p><strong>scatter_degree</strong> (<em>int</em><em>, </em><em>optional</em>) – polynomial degree of the 2d fit for the background scatter (default: 4)</p></li>
<li><p><strong>plot</strong> (<em>bool</em><em>, </em><em>optional</em>) – wether to plot the fitted polynomial and the data or not (default: False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>array[nord+1, ncol]</em> – background scatter between orders</p></li>
<li><p><em>array[nord+1, ncol]</em> – y positions of the interorder lines, the scatter values are taken from</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-pyreduce.extract">
<span id="pyreduce-extract-module"></span><h2>pyreduce.extract module<a class="headerlink" href="#module-pyreduce.extract" title="Link to this heading">¶</a></h2>
<p>Module for extracting data from observations</p>
<section id="authors">
<h3>Authors<a class="headerlink" href="#authors" title="Link to this heading">¶</a></h3>
</section>
<section id="version">
<h3>Version<a class="headerlink" href="#version" title="Link to this heading">¶</a></h3>
</section>
<section id="license">
<h3>License<a class="headerlink" href="#license" title="Link to this heading">¶</a></h3>
</section>
<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.extract.ProgressPlot">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.extract.</span></span><span class="sig-name descname"><span class="pre">ProgressPlot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nrow</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ncol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nslitf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nbad</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/extract.html#ProgressPlot"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.extract.ProgressPlot" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.extract.ProgressPlot.close">
<span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/extract.html#ProgressPlot.close"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.extract.ProgressPlot.close" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.extract.ProgressPlot.fix_linear">
<span class="sig-name descname"><span class="pre">fix_linear</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">limit</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fill</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/extract.html#ProgressPlot.fix_linear"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.extract.ProgressPlot.fix_linear" title="Link to this definition">¶</a></dt>
<dd><p>Assures the size of the 1D array data is equal to limit</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.extract.ProgressPlot.get_slitf">
<span class="sig-name descname"><span class="pre">get_slitf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slitf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ycen</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/extract.html#ProgressPlot.get_slitf"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.extract.ProgressPlot.get_slitf" title="Link to this definition">¶</a></dt>
<dd><p>get the slit function</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.extract.ProgressPlot.get_spec">
<span class="sig-name descname"><span class="pre">get_spec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slitf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ycen</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/extract.html#ProgressPlot.get_spec"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.extract.ProgressPlot.get_spec" title="Link to this definition">¶</a></dt>
<dd><p>get the spectrum corrected by the slit function</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.extract.ProgressPlot.plot">
<span class="sig-name descname"><span class="pre">plot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slitf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ycen</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ord_num</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">right</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/extract.html#ProgressPlot.plot"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.extract.ProgressPlot.plot" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.extract.Swath">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.extract.</span></span><span class="sig-name descname"><span class="pre">Swath</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nswath</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/extract.html#Swath"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.extract.Swath" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.extract.arc_extraction">
<span class="sig-prename descclassname"><span class="pre">pyreduce.extract.</span></span><span class="sig-name descname"><span class="pre">arc_extraction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extraction_width</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column_range</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gain</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">readnoise</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dark</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tilt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shear</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collapse_function</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'median'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/extract.html#arc_extraction"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.extract.arc_extraction" title="Link to this definition">¶</a></dt>
<dd><p>Use “simple” arc extraction to get a spectrum
Arc extraction simply takes the sum orthogonal to the order for extraction width pixels</p>
<p>This extraction makes a few rough assumptions and does not provide the most accurate results,
but rather a good approximation</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<em>array</em><em>[</em><em>nrow</em><em>, </em><em>ncol</em><em>]</em>) – image to extract</p></li>
<li><p><strong>orders</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>order</em><em>]</em>) – order tracing coefficients</p></li>
<li><p><strong>extraction_width</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>2</em><em>]</em>) – extraction width in pixels</p></li>
<li><p><strong>column_range</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>2</em><em>]</em>) – column range to use</p></li>
<li><p><strong>gain</strong> (<em>float</em><em>, </em><em>optional</em>) – adu to electron, amplifier gain (default: 1)</p></li>
<li><p><strong>readnoise</strong> (<em>float</em><em>, </em><em>optional</em>) – read out noise (default: 0)</p></li>
<li><p><strong>dark</strong> (<em>float</em><em>, </em><em>optional</em>) – dark current noise (default: 0)</p></li>
<li><p><strong>plot</strong> (<em>bool</em><em>, </em><em>optional</em>) – wether to plot the results (default: False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>spectrum</strong> (<em>array[nord, ncol]</em>) – extracted spectrum</p></li>
<li><p><strong>uncertainties</strong> (<em>array[nord, ncol]</em>) – uncertainties on extracted spectrum</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.extract.calc_scatter_correction">
<span class="sig-prename descclassname"><span class="pre">pyreduce.extract.</span></span><span class="sig-name descname"><span class="pre">calc_scatter_correction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scatter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/extract.html#calc_scatter_correction"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.extract.calc_scatter_correction" title="Link to this definition">¶</a></dt>
<dd><p>Calculate scatter correction
by interpolating between values?</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>scatter</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>degree_x</em><em>, </em><em>degree_y</em><em>)</em>) – 2D polynomial coefficients of the background scatter</p></li>
<li><p><strong>index</strong> (<em>tuple</em><em> (</em><em>array</em><em>, </em><em>array</em><em>)</em>) – indices of the swath within the overall image</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>scatter_correction</strong> – correction for scattered light</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array of shape (swath_width, swath_height)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.extract.calc_telluric_correction">
<span class="sig-prename descclassname"><span class="pre">pyreduce.extract.</span></span><span class="sig-name descname"><span class="pre">calc_telluric_correction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">telluric</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">img</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/extract.html#calc_telluric_correction"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.extract.calc_telluric_correction" title="Link to this definition">¶</a></dt>
<dd><p>Calculate telluric correction</p>
<p>If set to specific integer larger than 1 is used as the
offset from the order center line. The sky is then estimated by computing
median signal between this offset and the upper/lower limit of the
extraction window.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>telluric</strong> (<em>int</em>) – telluric correction parameter</p></li>
<li><p><strong>img</strong> (<em>array</em>) – image of the swath</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>tell</strong> – telluric correction</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.extract.correct_for_curvature">
<span class="sig-prename descclassname"><span class="pre">pyreduce.extract.</span></span><span class="sig-name descname"><span class="pre">correct_for_curvature</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img_order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tilt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shear</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xwd</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/extract.html#correct_for_curvature"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.extract.correct_for_curvature" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.extract.extend_orders">
<span class="sig-prename descclassname"><span class="pre">pyreduce.extract.</span></span><span class="sig-name descname"><span class="pre">extend_orders</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nrow</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/extract.html#extend_orders"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.extract.extend_orders" title="Link to this definition">¶</a></dt>
<dd><p>Extrapolate extra orders above and below the existing ones</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>orders</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>degree</em><em>]</em>) – order tracing coefficients</p></li>
<li><p><strong>nrow</strong> (<em>int</em>) – number of rows in the image</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>orders</strong> – extended orders</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array[nord + 2, degree]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.extract.extract">
<span class="sig-prename descclassname"><span class="pre">pyreduce.extract.</span></span><span class="sig-name descname"><span class="pre">extract</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extraction_width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extraction_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'optimal'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tilt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shear</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma_cutoff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/extract.html#extract"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.extract.extract" title="Link to this definition">¶</a></dt>
<dd><p>Extract the spectrum from an image</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<em>array</em><em>[</em><em>nrow</em><em>, </em><em>ncol</em><em>]</em><em>(</em><em>float</em><em>)</em>) – observation to extract</p></li>
<li><p><strong>orders</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>degree</em><em>]</em><em>(</em><em>float</em><em>)</em>) – polynomial coefficients of the order tracing</p></li>
<li><p><strong>column_range</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>2</em><em>]</em><em>(</em><em>int</em><em>)</em><em>, </em><em>optional</em>) – range of pixels to use for each order (default: use all)</p></li>
<li><p><strong>order_range</strong> (<em>array</em><em>[</em><em>2</em><em>]</em><em>(</em><em>int</em><em>)</em><em>, </em><em>optional</em>) – range of orders to extract, orders have to be consecutive (default: use all)</p></li>
<li><p><strong>extraction_width</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>2</em><em>]</em><em>(</em><em>{float</em><em>, </em><em>int}</em><em>)</em><em>, </em><em>optional</em>) – extraction width above and below each order, values below 1.5 are considered relative, while values above are absolute (default: 0.5)</p></li>
<li><p><strong>extraction_type</strong> (<em>{&quot;optimal&quot;</em><em>, </em><em>&quot;arc&quot;</em><em>, </em><em>&quot;normalize&quot;}</em><em>, </em><em>optional</em>) – which extracttion algorithm to use, “optimal” uses optimal extraction, “arc” uses simple arc extraction, and “normalize” also uses optimal extraction, but returns the normalized image (default: “optimal”)</p></li>
<li><p><strong>tilt</strong> (<em>float</em><em> or </em><em>array</em><em>[</em><em>nord</em><em>, </em><em>ncol</em><em>]</em><em>, </em><em>optional</em>) – The tilt (1st order curvature) of the slit for curved extraction. Will use vertical extraction if no tilt is set. (default: None, i.e. tilt = 0)</p></li>
<li><p><strong>shear</strong> (<em>float</em><em> or </em><em>array</em><em>[</em><em>nord</em><em>, </em><em>ncol</em><em>]</em><em>, </em><em>optional</em>) – The shear (2nd order curvature) of the slit for curved extraction (default: None, i.e. shear = 0)</p></li>
<li><p><strong>polarization</strong> (<em>bool</em><em>, </em><em>optional</em>) – if true, pairs of orders are considered to belong to the same order, but different polarization. Only affects the scatter (default: False)</p></li>
<li><p><strong>**kwargs</strong> – parameters for extraction functions</p></li>
<li><p><strong>optional</strong> – parameters for extraction functions</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>spec</strong> (<em>array[nord, ncol](float)</em>) – extracted spectrum for each order</p></li>
<li><p><strong>uncertainties</strong> (<em>array[nord, ncol](float)</em>) – uncertainties on the spectrum</p></li>
<li><p><em>if extraction_type == “normalize” instead return</em></p></li>
<li><p><strong>im_norm</strong> (<em>array[nrow, ncol](float)</em>) – normalized image</p></li>
<li><p><strong>im_ordr</strong> (<em>array[nrow, ncol](float)</em>) – image with just the orders</p></li>
<li><p><strong>blaze</strong> (<em>array[nord, ncol](float)</em>) – extracted spectrum (equals blaze if img was the flat field)</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.extract.extract_spectrum">
<span class="sig-prename descclassname"><span class="pre">pyreduce.extract.</span></span><span class="sig-name descname"><span class="pre">extract_spectrum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ycen</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">yrange</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xrange</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gain</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">readnoise</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lambda_sf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lambda_sp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">osample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">swath_width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxiter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">telluric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scatter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tilt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shear</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">im_norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">im_ordr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_spec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_sunc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_slitf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">progress</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ord_num</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/extract.html#extract_spectrum"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.extract.extract_spectrum" title="Link to this definition">¶</a></dt>
<dd><p>Extract the spectrum of a single order from an image
The order is split into several swathes of roughly swath_width length, which overlap half-half
For each swath a spectrum and slitfunction are extracted
overlapping sections are combined using linear weights (centrum is strongest, falling off to the edges)
Here is the layout for the bins:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="mi">1</span><span class="n">st</span> <span class="n">swath</span>    <span class="mi">3</span><span class="n">rd</span> <span class="n">swath</span>    <span class="mi">5</span><span class="n">th</span> <span class="n">swath</span>      <span class="o">...</span>
<span class="o">/============|============|============|============|============|</span>

          <span class="mi">2</span><span class="n">nd</span> <span class="n">swath</span>    <span class="mi">4</span><span class="n">th</span> <span class="n">swath</span>    <span class="mi">6</span><span class="n">th</span> <span class="n">swath</span>
       <span class="o">|------------|------------|------------|------------|</span>
       <span class="o">|.....|</span>
       <span class="n">overlap</span>

       <span class="o">+</span>     <span class="o">*******</span> <span class="mi">1</span>
        <span class="o">+</span>   <span class="o">*</span>
         <span class="o">+</span> <span class="o">*</span>
          <span class="o">*</span>            <span class="n">weights</span> <span class="p">(</span><span class="o">+</span><span class="p">)</span> <span class="n">previous</span> <span class="n">swath</span><span class="p">,</span> <span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">current</span> <span class="n">swath</span>
         <span class="o">*</span> <span class="o">+</span>
        <span class="o">*</span>   <span class="o">+</span>
       <span class="o">*</span>     <span class="o">+++++++</span> <span class="mi">0</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<em>array</em><em>[</em><em>nrow</em><em>, </em><em>ncol</em><em>]</em>) – observation (or similar)</p></li>
<li><p><strong>ycen</strong> (<em>array</em><em>[</em><em>ncol</em><em>]</em>) – order trace of the current order</p></li>
<li><p><strong>yrange</strong> (<em>tuple</em><em>(</em><em>int</em><em>, </em><em>int</em><em>)</em>) – extraction width in pixles, below and above</p></li>
<li><p><strong>xrange</strong> (<em>tuple</em><em>(</em><em>int</em><em>, </em><em>int</em><em>)</em>) – columns range to extract (low, high)</p></li>
<li><p><strong>gain</strong> (<em>float</em><em>, </em><em>optional</em>) – adu to electron, amplifier gain (default: 1)</p></li>
<li><p><strong>readnoise</strong> (<em>float</em><em>, </em><em>optional</em>) – read out noise factor (default: 0)</p></li>
<li><p><strong>lambda_sf</strong> (<em>float</em><em>, </em><em>optional</em>) – slit function smoothing parameter, usually very small (default: 0.1)</p></li>
<li><p><strong>lambda_sp</strong> (<em>int</em><em>, </em><em>optional</em>) – spectrum smoothing parameter, usually very small (default: 0)</p></li>
<li><p><strong>osample</strong> (<em>int</em><em>, </em><em>optional</em>) – oversampling factor, i.e. how many subpixels to create per pixel (default: 1, i.e. no oversampling)</p></li>
<li><p><strong>swath_width</strong> (<em>int</em><em>, </em><em>optional</em>) – swath width suggestion, actual width depends also on ncol, see make_bins (default: None, which will determine the width based on the order tracing)</p></li>
<li><p><strong>telluric</strong> (<em>{float</em><em>, </em><em>None}</em><em>, </em><em>optional</em>) – telluric correction factor (default: None, i.e. no telluric correction)</p></li>
<li><p><strong>scatter</strong> (<em>{array</em><em>, </em><em>None}</em><em>, </em><em>optional</em>) – background scatter as 2d polynomial coefficients (default: None, no correction)</p></li>
<li><p><strong>normalize</strong> (<em>bool</em><em>, </em><em>optional</em>) – whether to create a normalized image. If true, im_norm and im_ordr are used as output (default: False)</p></li>
<li><p><strong>threshold</strong> (<em>int</em><em>, </em><em>optional</em>) – threshold for normalization (default: 0)</p></li>
<li><p><strong>tilt</strong> (<em>array</em><em>[</em><em>ncol</em><em>]</em><em>, </em><em>optional</em>) – The tilt (1st order curvature) of the slit in this order for the curved extraction (default: None, i.e. tilt = 0)</p></li>
<li><p><strong>shear</strong> (<em>array</em><em>[</em><em>ncol</em><em>]</em><em>, </em><em>optional</em>) – The shear (2nd order curvature) of the slit in this order for the curved extraction (default: None, i.e. shear = 0)</p></li>
<li><p><strong>plot</strong> (<em>bool</em><em>, </em><em>optional</em>) – wether to plot the progress, plotting will slow down the procedure significantly (default: False)</p></li>
<li><p><strong>ord_num</strong> (<em>int</em><em>, </em><em>optional</em>) – current order number, just for plotting (default: 0)</p></li>
<li><p><strong>im_norm</strong> (<em>array</em><em>[</em><em>nrow</em><em>, </em><em>ncol</em><em>]</em><em>, </em><em>optional</em>) – normalized image, only output if normalize is True (default: None)</p></li>
<li><p><strong>im_ordr</strong> (<em>array</em><em>[</em><em>nrow</em><em>, </em><em>ncol</em><em>]</em><em>, </em><em>optional</em>) – image of the order blaze, only output if normalize is True (default: None)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>spec</strong> (<em>array[ncol]</em>) – extracted spectrum</p></li>
<li><p><strong>slitf</strong> (<em>array[nslitf]</em>) – extracted slitfunction</p></li>
<li><p><strong>mask</strong> (<em>array[ncol]</em>) – mask of the column range to use in the spectrum</p></li>
<li><p><strong>unc</strong> (<em>array[ncol]</em>) – uncertainty on the spectrum</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.extract.fix_column_range">
<span class="sig-prename descclassname"><span class="pre">pyreduce.extract.</span></span><span class="sig-name descname"><span class="pre">fix_column_range</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">column_range</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extraction_width</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nrow</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ncol</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/extract.html#fix_column_range"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.extract.fix_column_range" title="Link to this definition">¶</a></dt>
<dd><p>Fix the column range, so that no pixels outside the image will be accessed (Thus avoiding errors)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<em>array</em><em>[</em><em>nrow</em><em>, </em><em>ncol</em><em>]</em>) – image</p></li>
<li><p><strong>orders</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>degree</em><em>]</em>) – order tracing coefficients</p></li>
<li><p><strong>extraction_width</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>2</em><em>]</em>) – extraction width in pixels, (below, above)</p></li>
<li><p><strong>column_range</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>2</em><em>]</em>) – current column range</p></li>
<li><p><strong>no_clip</strong> (<em>bool</em><em>, </em><em>optional</em>) – if False, new column range will be smaller or equal to current column range, otherwise it can also be larger (default: False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>column_range</strong> – updated column range</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array[nord, 2]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.extract.fix_extraction_width">
<span class="sig-prename descclassname"><span class="pre">pyreduce.extract.</span></span><span class="sig-name descname"><span class="pre">fix_extraction_width</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xwd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ncol</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/extract.html#fix_extraction_width"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.extract.fix_extraction_width" title="Link to this definition">¶</a></dt>
<dd><p>Convert fractional extraction width to pixel range</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>extraction_width</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>2</em><em>]</em>) – current extraction width, in pixels or fractions (for values below 1.5)</p></li>
<li><p><strong>orders</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>degree</em><em>]</em>) – order tracing coefficients</p></li>
<li><p><strong>column_range</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>2</em><em>]</em>) – column range to use</p></li>
<li><p><strong>ncol</strong> (<em>int</em>) – number of columns in image</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>extraction_width</strong> – updated extraction width in pixels</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array[nord, 2]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.extract.fix_parameters">
<span class="sig-prename descclassname"><span class="pre">pyreduce.extract.</span></span><span class="sig-name descname"><span class="pre">fix_parameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xwd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nrow</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ncol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nord</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_column_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/extract.html#fix_parameters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.extract.fix_parameters" title="Link to this definition">¶</a></dt>
<dd><p>Fix extraction width and column range, so that all pixels used are within the image.
I.e. the column range is cut so that the everything is within the image</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xwd</strong> (<em>float</em><em>, </em><em>array</em>) – Extraction width, either one value for all orders, or the whole array</p></li>
<li><p><strong>cr</strong> (<em>2-tuple</em><em>(</em><em>int</em><em>)</em><em>, </em><em>array</em>) – Column range, either one value for all orders, or the whole array</p></li>
<li><p><strong>orders</strong> (<em>array</em>) – polynomial coefficients that describe each order</p></li>
<li><p><strong>nrow</strong> (<em>int</em>) – Number of rows in the image</p></li>
<li><p><strong>ncol</strong> (<em>int</em>) – Number of columns in the image</p></li>
<li><p><strong>nord</strong> (<em>int</em>) – Number of orders in the image</p></li>
<li><p><strong>ignore_column_range</strong> (<em>bool</em><em>, </em><em>optional</em>) – if true does not change the column range, however this may lead to problems with the extraction, by default False</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>xwd</strong> (<em>array</em>) – fixed extraction width</p></li>
<li><p><strong>cr</strong> (<em>array</em>) – fixed column range</p></li>
<li><p><strong>orders</strong> (<em>array</em>) – the same orders as before</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.extract.get_mask">
<span class="sig-prename descclassname"><span class="pre">pyreduce.extract.</span></span><span class="sig-name descname"><span class="pre">get_mask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/extract.html#get_mask"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.extract.get_mask" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.extract.get_y_scale">
<span class="sig-prename descclassname"><span class="pre">pyreduce.extract.</span></span><span class="sig-name descname"><span class="pre">get_y_scale</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ycen</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xrange</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extraction_width</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nrow</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/extract.html#get_y_scale"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.extract.get_y_scale" title="Link to this definition">¶</a></dt>
<dd><p>Calculate the y limits of the order
This is especially important at the edges</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ycen</strong> (<em>array</em><em>[</em><em>ncol</em><em>]</em>) – order trace</p></li>
<li><p><strong>xrange</strong> (<em>tuple</em><em>(</em><em>int</em><em>, </em><em>int</em><em>)</em>) – column range</p></li>
<li><p><strong>extraction_width</strong> (<em>tuple</em><em>(</em><em>int</em><em>, </em><em>int</em><em>)</em>) – extraction width in pixels below and above the order</p></li>
<li><p><strong>nrow</strong> (<em>int</em>) – number of rows in the image, defines upper edge</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>y_low, y_high</strong> – lower and upper y bound for extraction</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int, int</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.extract.make_bins">
<span class="sig-prename descclassname"><span class="pre">pyreduce.extract.</span></span><span class="sig-name descname"><span class="pre">make_bins</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">swath_width</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xlow</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xhigh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ycen</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/extract.html#make_bins"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.extract.make_bins" title="Link to this definition">¶</a></dt>
<dd><p>Create bins for the swathes
Bins are roughly equally sized, have roughly length swath width (if given)
and overlap roughly half-half with each other</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>swath_width</strong> (<em>{int</em><em>, </em><em>None}</em>) – initial value for the swath_width, bins will have roughly that size, but exact value may change
if swath_width is None, determine a good value, from the data</p></li>
<li><p><strong>xlow</strong> (<em>int</em>) – lower bound for x values</p></li>
<li><p><strong>xhigh</strong> (<em>int</em>) – upper bound for x values</p></li>
<li><p><strong>ycen</strong> (<em>array</em><em>[</em><em>ncol</em><em>]</em>) – center of the order trace</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>nbin</strong> (<em>int</em>) – number of bins</p></li>
<li><p><strong>bins_start</strong> (<em>array[nbin]</em>) – left(beginning) side of the bins</p></li>
<li><p><strong>bins_end</strong> (<em>array[nbin]</em>) – right(ending) side of the bins</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.extract.model">
<span class="sig-prename descclassname"><span class="pre">pyreduce.extract.</span></span><span class="sig-name descname"><span class="pre">model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slitf</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/extract.html#model"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.extract.model" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.extract.model_image">
<span class="sig-prename descclassname"><span class="pre">pyreduce.extract.</span></span><span class="sig-name descname"><span class="pre">model_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xwd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tilt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shear</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/extract.html#model_image"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.extract.model_image" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.extract.optimal_extraction">
<span class="sig-prename descclassname"><span class="pre">pyreduce.extract.</span></span><span class="sig-name descname"><span class="pre">optimal_extraction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extraction_width</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column_range</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tilt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shear</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/extract.html#optimal_extraction"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.extract.optimal_extraction" title="Link to this definition">¶</a></dt>
<dd><p>Use optimal extraction to get spectra</p>
<p>This functions just loops over the orders, the actual work is done in extract_spectrum</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<em>array</em><em>[</em><em>nrow</em><em>, </em><em>ncol</em><em>]</em>) – image to extract</p></li>
<li><p><strong>orders</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>degree</em><em>]</em>) – order tracing coefficients</p></li>
<li><p><strong>extraction_width</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>2</em><em>]</em>) – extraction width in pixels</p></li>
<li><p><strong>column_range</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>2</em><em>]</em>) – column range to use</p></li>
<li><p><strong>scatter</strong> (<em>array</em><em>[</em><em>nord</em><em>, </em><em>4</em><em>, </em><em>ncol</em><em>]</em>) – background scatter (or None)</p></li>
<li><p><strong>**kwargs</strong> – other parameters for the extraction (see extract_spectrum)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>spectrum</strong> (<em>array[nord, ncol]</em>) – extracted spectrum</p></li>
<li><p><strong>slitfunction</strong> (<em>array[nord, nslitf]</em>) – recovered slitfunction</p></li>
<li><p><strong>uncertainties</strong> (<em>array[nord, ncol]</em>) – uncertainties on the spectrum</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.extract.plot_comparison">
<span class="sig-prename descclassname"><span class="pre">pyreduce.extract.</span></span><span class="sig-name descname"><span class="pre">plot_comparison</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">original</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spectrum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slitf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extraction_width</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column_range</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/extract.html#plot_comparison"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.extract.plot_comparison" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-pyreduce.make_shear">
<span id="pyreduce-make-shear-module"></span><h2>pyreduce.make_shear module<a class="headerlink" href="#module-pyreduce.make_shear" title="Link to this heading">¶</a></h2>
<p>Calculate the tilt based on a reference spectrum with high SNR, e.g. Wavelength calibration image</p>
<section id="id1">
<h3>Authors<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h3>
<p>Nikolai Piskunov
Ansgar Wehrhahn</p>
</section>
<section id="id2">
<h3>Version<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h3>
<p>0.9 - NP - IDL Version
1.0 - AW - Python Version</p>
</section>
<section id="id3">
<h3>License<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h3>
</section>
<hr class="docutils" />
<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.make_shear.Curvature">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.make_shear.</span></span><span class="sig-name descname"><span class="pre">Curvature</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extraction_width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window_width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">9</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">peak_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">peak_width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fit_degree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma_cutoff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'1D'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">peak_function</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'gaussian'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">curv_degree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/make_shear.html#Curvature"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.make_shear.Curvature" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.make_shear.Curvature.eval">
<span class="sig-name descname"><span class="pre">eval</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">peaks</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coef_tilt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coef_shear</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/make_shear.html#Curvature.eval"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.make_shear.Curvature.eval" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.make_shear.Curvature.execute">
<span class="sig-name descname"><span class="pre">execute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">extracted</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">original</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/make_shear.html#Curvature.execute"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.make_shear.Curvature.execute" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.make_shear.Curvature.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">peaks</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tilt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shear</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/make_shear.html#Curvature.fit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.make_shear.Curvature.fit" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.make_shear.Curvature.mode">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">mode</span></span><a class="headerlink" href="#pyreduce.make_shear.Curvature.mode" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.make_shear.Curvature.n">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">n</span></span><a class="headerlink" href="#pyreduce.make_shear.Curvature.n" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.make_shear.Curvature.nord">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">nord</span></span><a class="headerlink" href="#pyreduce.make_shear.Curvature.nord" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.make_shear.Curvature.plot_comparison">
<span class="sig-name descname"><span class="pre">plot_comparison</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">original</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tilt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shear</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">peaks</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/make_shear.html#Curvature.plot_comparison"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.make_shear.Curvature.plot_comparison" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.make_shear.Curvature.plot_results">
<span class="sig-name descname"><span class="pre">plot_results</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ncol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_peaks</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_vec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_tilt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_shear</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tilt_x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shear_x</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/make_shear.html#Curvature.plot_results"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.make_shear.Curvature.plot_results" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.make_shear.ProgressPlot">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.make_shear.</span></span><span class="sig-name descname"><span class="pre">ProgressPlot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ncol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">width</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/make_shear.html#ProgressPlot"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.make_shear.ProgressPlot" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.make_shear.ProgressPlot.close">
<span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/make_shear.html#ProgressPlot.close"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.make_shear.ProgressPlot.close" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.make_shear.ProgressPlot.update_plot1">
<span class="sig-name descname"><span class="pre">update_plot1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vector</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">peak</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">offset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/make_shear.html#ProgressPlot.update_plot1"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.make_shear.ProgressPlot.update_plot1" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.make_shear.ProgressPlot.update_plot2">
<span class="sig-name descname"><span class="pre">update_plot2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tilt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shear</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">peak</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/make_shear.html#ProgressPlot.update_plot2"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.make_shear.ProgressPlot.update_plot2" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.make_shear.gaussian">
<span class="sig-prename descclassname"><span class="pre">pyreduce.make_shear.</span></span><span class="sig-name descname"><span class="pre">gaussian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sig</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/make_shear.html#gaussian"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.make_shear.gaussian" title="Link to this definition">¶</a></dt>
<dd><p>A: height
mu: offset from central line
sig: standard deviation</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.make_shear.lorentzian">
<span class="sig-prename descclassname"><span class="pre">pyreduce.make_shear.</span></span><span class="sig-name descname"><span class="pre">lorentzian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mu</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/make_shear.html#lorentzian"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.make_shear.lorentzian" title="Link to this definition">¶</a></dt>
<dd><p>A: height
x0: offset from central line
mu: width of lorentzian</p>
</dd></dl>

</section>
<section id="module-pyreduce.reduce">
<span id="pyreduce-reduce-module"></span><h2>pyreduce.reduce module<a class="headerlink" href="#module-pyreduce.reduce" title="Link to this heading">¶</a></h2>
<p>REDUCE script for spectrograph data</p>
<section id="id4">
<h3>Authors<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h3>
<p>Ansgar Wehrhahn  (<a class="reference external" href="mailto:ansgar&#46;wehrhahn&#37;&#52;&#48;physics&#46;uu&#46;se">ansgar<span>&#46;</span>wehrhahn<span>&#64;</span>physics<span>&#46;</span>uu<span>&#46;</span>se</a>)
Thomas Marquart  (<a class="reference external" href="mailto:thomas&#46;marquart&#37;&#52;&#48;physics&#46;uu&#46;se">thomas<span>&#46;</span>marquart<span>&#64;</span>physics<span>&#46;</span>uu<span>&#46;</span>se</a>)
Alexis Lavail    (<a class="reference external" href="mailto:alexis&#46;lavail&#37;&#52;&#48;physics&#46;uu&#46;se">alexis<span>&#46;</span>lavail<span>&#64;</span>physics<span>&#46;</span>uu<span>&#46;</span>se</a>)
Nikolai Piskunov (<a class="reference external" href="mailto:nikolai&#46;piskunov&#37;&#52;&#48;physics&#46;uu&#46;se">nikolai<span>&#46;</span>piskunov<span>&#64;</span>physics<span>&#46;</span>uu<span>&#46;</span>se</a>)</p>
</section>
<section id="id5">
<h3>Version<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h3>
<p>1.0 - Initial PyReduce</p>
</section>
<section id="id6">
<h3>License<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h3>
<p>…</p>
</section>
<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.reduce.BackgroundScatter">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.reduce.</span></span><span class="sig-name descname"><span class="pre">BackgroundScatter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#BackgroundScatter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.BackgroundScatter" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyreduce.reduce.CalibrationStep" title="pyreduce.reduce.CalibrationStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">CalibrationStep</span></code></a></p>
<p>Determine the background scatter</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.BackgroundScatter.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#BackgroundScatter.load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.BackgroundScatter.load" title="Link to this definition">¶</a></dt>
<dd><p>Load scatter results from disk</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>scatter</strong> – scatter coefficients</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>array</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.BackgroundScatter.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orders</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#BackgroundScatter.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.BackgroundScatter.run" title="Link to this definition">¶</a></dt>
<dd><p>Execute the current step</p>
<p>This should fail if files are missing or anything else goes wrong.
If the user does not want to run this step, they should not specify it in steps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>files</strong> (<em>list</em><em>(</em><em>str</em><em>)</em>) – data files required for this step</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>NotImplementedError</strong> – needs to be implemented for each step</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.BackgroundScatter.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scatter</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#BackgroundScatter.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.BackgroundScatter.save" title="Link to this definition">¶</a></dt>
<dd><p>Save scatter results to disk</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>scatter</strong> (<em>array</em>) – scatter coefficients</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.reduce.BackgroundScatter.savefile">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">savefile</span></span><a class="headerlink" href="#pyreduce.reduce.BackgroundScatter.savefile" title="Link to this definition">¶</a></dt>
<dd><p>Name of the scatter file</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.BackgroundScatter.scatter_degree">
<span class="sig-name descname"><span class="pre">scatter_degree</span></span><a class="headerlink" href="#pyreduce.reduce.BackgroundScatter.scatter_degree" title="Link to this definition">¶</a></dt>
<dd><p>Polynomial degrees for the background scatter fit, in row, column direction</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple(int, int)</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.reduce.Bias">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.reduce.</span></span><span class="sig-name descname"><span class="pre">Bias</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#Bias"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.Bias" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyreduce.reduce.Step" title="pyreduce.reduce.Step"><code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code></a></p>
<p>Calculates the master bias</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.Bias.degree">
<span class="sig-name descname"><span class="pre">degree</span></span><a class="headerlink" href="#pyreduce.reduce.Bias.degree" title="Link to this definition">¶</a></dt>
<dd><p>polynomial degree of the fit between exposure time and pixel values</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.Bias.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mask</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#Bias.load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.Bias.load" title="Link to this definition">¶</a></dt>
<dd><p>Load the master bias from a previous run</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>mask</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nrow</em><em>, </em><em>ncol</em><em>)</em>) – Bad pixel mask</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>bias</strong> (<em>masked array of shape (nrow, ncol)</em>) – master bias data, with the bad pixel mask applied</p></li>
<li><p><strong>bhead</strong> (<em>FITS header</em>) – header of the master bias</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.Bias.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#Bias.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.Bias.run" title="Link to this definition">¶</a></dt>
<dd><p>Calculate the master bias</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>files</strong> (<em>list</em><em>(</em><em>str</em><em>)</em>) – bias files</p></li>
<li><p><strong>mask</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nrow</em><em>, </em><em>ncol</em><em>)</em>) – bad pixel map</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>bias</strong> (<em>masked array of shape (nrow, ncol)</em>) – master bias data, with the bad pixel mask applied</p></li>
<li><p><strong>bhead</strong> (<em>FITS header</em>) – header of the master bias</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.Bias.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bias</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bhead</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#Bias.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.Bias.save" title="Link to this definition">¶</a></dt>
<dd><p>Save the master bias to a FITS file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bias</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nrow</em><em>, </em><em>ncol</em><em>)</em>) – bias data</p></li>
<li><p><strong>bhead</strong> (<em>FITS header</em>) – bias header</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.reduce.Bias.savefile">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">savefile</span></span><a class="headerlink" href="#pyreduce.reduce.Bias.savefile" title="Link to this definition">¶</a></dt>
<dd><p>Name of master bias fits file</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.reduce.CalibrationStep">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.reduce.</span></span><span class="sig-name descname"><span class="pre">CalibrationStep</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#CalibrationStep"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.CalibrationStep" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyreduce.reduce.Step" title="pyreduce.reduce.Step"><code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code></a></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.CalibrationStep.bias_scaling">
<span class="sig-name descname"><span class="pre">bias_scaling</span></span><a class="headerlink" href="#pyreduce.reduce.CalibrationStep.bias_scaling" title="Link to this definition">¶</a></dt>
<dd><p>how to adjust for diferences between the bias and flat field exposure times</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>{‘number_of_files’, ‘exposure_time’, ‘mean’, ‘median’, ‘none’}</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.CalibrationStep.calibrate">
<span class="sig-name descname"><span class="pre">calibrate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm_flat</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#CalibrationStep.calibrate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.CalibrationStep.calibrate" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.CalibrationStep.norm_scaling">
<span class="sig-name descname"><span class="pre">norm_scaling</span></span><a class="headerlink" href="#pyreduce.reduce.CalibrationStep.norm_scaling" title="Link to this definition">¶</a></dt>
<dd><p>how to apply the normalized flat field</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>{‘divide’, ‘none’}</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.reduce.ContinuumNormalization">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.reduce.</span></span><span class="sig-name descname"><span class="pre">ContinuumNormalization</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#ContinuumNormalization"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.ContinuumNormalization" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyreduce.reduce.Step" title="pyreduce.reduce.Step"><code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code></a></p>
<p>Determine the continuum to each observation</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.ContinuumNormalization.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">norm_flat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">science</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#ContinuumNormalization.load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.ContinuumNormalization.load" title="Link to this definition">¶</a></dt>
<dd><p>Load the results from the continuum normalization</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>heads</strong> (<em>list(FITS header)</em>) – FITS headers of each observation</p></li>
<li><p><strong>specs</strong> (<em>list(array of shape (nord, ncol))</em>) – extracted spectra</p></li>
<li><p><strong>sigmas</strong> (<em>list(array of shape (nord, ncol))</em>) – uncertainties of the extracted spectra</p></li>
<li><p><strong>conts</strong> (<em>list(array of shape (nord, ncol))</em>) – continuum for each spectrum</p></li>
<li><p><strong>columns</strong> (<em>list(array of shape (nord, 2))</em>) – column ranges for each spectra</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.ContinuumNormalization.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">science</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq_comb</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm_flat</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#ContinuumNormalization.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.ContinuumNormalization.run" title="Link to this definition">¶</a></dt>
<dd><p>Determine the continuum to each observation
Also splices the orders together</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>science</strong> (<em>tuple</em>) – results from science step</p></li>
<li><p><strong>freq_comb</strong> (<em>tuple</em>) – results from freq_comb step (or wavecal if those don’t exist)</p></li>
<li><p><strong>norm_flat</strong> (<em>tuple</em>) – results from the normalized flatfield step</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>heads</strong> (<em>list(FITS header)</em>) – FITS headers of each observation</p></li>
<li><p><strong>specs</strong> (<em>list(array of shape (nord, ncol))</em>) – extracted spectra</p></li>
<li><p><strong>sigmas</strong> (<em>list(array of shape (nord, ncol))</em>) – uncertainties of the extracted spectra</p></li>
<li><p><strong>conts</strong> (<em>list(array of shape (nord, ncol))</em>) – continuum for each spectrum</p></li>
<li><p><strong>columns</strong> (<em>list(array of shape (nord, 2))</em>) – column ranges for each spectra</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.ContinuumNormalization.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">heads</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigmas</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">conts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">columns</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#ContinuumNormalization.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.ContinuumNormalization.save" title="Link to this definition">¶</a></dt>
<dd><p>Save the results from the continuum normalization</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>heads</strong> (<em>list</em><em>(</em><em>FITS header</em><em>)</em>) – FITS headers of each observation</p></li>
<li><p><strong>specs</strong> (<em>list</em><em>(</em><em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em><em>)</em>) – extracted spectra</p></li>
<li><p><strong>sigmas</strong> (<em>list</em><em>(</em><em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em><em>)</em>) – uncertainties of the extracted spectra</p></li>
<li><p><strong>conts</strong> (<em>list</em><em>(</em><em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em><em>)</em>) – continuum for each spectrum</p></li>
<li><p><strong>columns</strong> (<em>list</em><em>(</em><em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>2</em><em>)</em><em>)</em>) – column ranges for each spectra</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.reduce.ContinuumNormalization.savefile">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">savefile</span></span><a class="headerlink" href="#pyreduce.reduce.ContinuumNormalization.savefile" title="Link to this definition">¶</a></dt>
<dd><p>savefile name</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.reduce.ExtractionStep">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.reduce.</span></span><span class="sig-name descname"><span class="pre">ExtractionStep</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#ExtractionStep"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.ExtractionStep" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyreduce.reduce.Step" title="pyreduce.reduce.Step"><code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code></a></p>
<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.ExtractionStep.extract">
<span class="sig-name descname"><span class="pre">extract</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">head</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">curvature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scatter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#ExtractionStep.extract"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.ExtractionStep.extract" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.ExtractionStep.extraction_kwargs">
<span class="sig-name descname"><span class="pre">extraction_kwargs</span></span><a class="headerlink" href="#pyreduce.reduce.ExtractionStep.extraction_kwargs" title="Link to this definition">¶</a></dt>
<dd><p>arguments for the extraction</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.ExtractionStep.extraction_method">
<span class="sig-name descname"><span class="pre">extraction_method</span></span><a class="headerlink" href="#pyreduce.reduce.ExtractionStep.extraction_method" title="Link to this definition">¶</a></dt>
<dd><p>Extraction method to use</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>{‘arc’, ‘optimal’}</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.reduce.Finalize">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.reduce.</span></span><span class="sig-name descname"><span class="pre">Finalize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#Finalize"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.Finalize" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyreduce.reduce.Step" title="pyreduce.reduce.Step"><code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code></a></p>
<p>Create the final output files</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.Finalize.output_file">
<span class="sig-name descname"><span class="pre">output_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">number</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#Finalize.output_file"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.Finalize.output_file" title="Link to this definition">¶</a></dt>
<dd><p>str: output file name</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.Finalize.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">continuum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq_comb</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#Finalize.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.Finalize.run" title="Link to this definition">¶</a></dt>
<dd><p>Create the final output files</p>
<dl class="simple">
<dt>this is includes:</dt><dd><ul class="simple">
<li><p>heliocentric corrections</p></li>
<li><p>creating one echelle file</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>continuum</strong> (<em>tuple</em>) – results from the continuum normalization</p></li>
<li><p><strong>freq_comb</strong> (<em>tuple</em>) – results from the frequency comb step (or wavelength calibration)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.Finalize.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">head</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cont</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wave</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">columns</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#Finalize.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.Finalize.save" title="Link to this definition">¶</a></dt>
<dd><p>Save one output spectrum to disk</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>i</strong> (<em>int</em>) – individual number of each file</p></li>
<li><p><strong>head</strong> (<em>FITS header</em>) – FITS header</p></li>
<li><p><strong>spec</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em>) – final spectrum</p></li>
<li><p><strong>sigma</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em>) – final uncertainties</p></li>
<li><p><strong>cont</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em>) – final continuum scales</p></li>
<li><p><strong>wave</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em>) – wavelength solution</p></li>
<li><p><strong>columns</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>2</em><em>)</em>) – columns that carry signal</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>out_file</strong> – name of the output file</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.Finalize.save_config_to_header">
<span class="sig-name descname"><span class="pre">save_config_to_header</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">head</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'PR'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#Finalize.save_config_to_header"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.Finalize.save_config_to_header" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.reduce.FitsIOStep">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.reduce.</span></span><span class="sig-name descname"><span class="pre">FitsIOStep</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#FitsIOStep"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.FitsIOStep" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyreduce.reduce.Step" title="pyreduce.reduce.Step"><code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code></a></p>
<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.FitsIOStep.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mask</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#FitsIOStep.load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.FitsIOStep.load" title="Link to this definition">¶</a></dt>
<dd><p>Load the master bias from a previous run</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>mask</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nrow</em><em>, </em><em>ncol</em><em>)</em>) – Bad pixel mask</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>data</strong> (<em>masked array of shape (nrow, ncol)</em>) – master bias data, with the bad pixel mask applied</p></li>
<li><p><strong>head</strong> (<em>FITS header</em>) – header of the master bias</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.FitsIOStep.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">head</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#FitsIOStep.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.FitsIOStep.save" title="Link to this definition">¶</a></dt>
<dd><p>Save the data to a FITS file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nrow</em><em>, </em><em>ncol</em><em>)</em>) – bias data</p></li>
<li><p><strong>head</strong> (<em>FITS header</em>) – bias header</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.reduce.Flat">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.reduce.</span></span><span class="sig-name descname"><span class="pre">Flat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#Flat"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.Flat" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyreduce.reduce.CalibrationStep" title="pyreduce.reduce.CalibrationStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">CalibrationStep</span></code></a></p>
<p>Calculates the master flat</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.Flat.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mask</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#Flat.load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.Flat.load" title="Link to this definition">¶</a></dt>
<dd><p>Load master flat from disk</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>mask</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nrow</em><em>, </em><em>ncol</em><em>)</em>) – Bad pixel mask</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>flat</strong> (<em>masked array of shape (nrow, ncol)</em>) – Master flat with bad pixel map applied</p></li>
<li><p><strong>fhead</strong> (<em>FITS header</em>) – Master flat FITS header</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.Flat.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#Flat.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.Flat.run" title="Link to this definition">¶</a></dt>
<dd><p>Calculate the master flat, with the bias already subtracted</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>files</strong> (<em>list</em><em>(</em><em>str</em><em>)</em>) – flat files</p></li>
<li><p><strong>bias</strong> (<em>tuple</em><em>(</em><em>array</em><em> of </em><em>shape</em><em> (</em><em>nrow</em><em>, </em><em>ncol</em><em>)</em><em>, </em><em>FITS header</em><em>)</em>) – master bias and header</p></li>
<li><p><strong>mask</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nrow</em><em>, </em><em>ncol</em><em>)</em>) – Bad pixel mask</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>flat</strong> (<em>masked array of shape (nrow, ncol)</em>) – Master flat with bad pixel map applied</p></li>
<li><p><strong>fhead</strong> (<em>FITS header</em>) – Master flat FITS header</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.Flat.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">flat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fhead</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#Flat.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.Flat.save" title="Link to this definition">¶</a></dt>
<dd><p>Save the master flat to a FITS file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>flat</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nrow</em><em>, </em><em>ncol</em><em>)</em>) – master flat data</p></li>
<li><p><strong>fhead</strong> (<em>FITS header</em>) – master flat header</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.reduce.Flat.savefile">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">savefile</span></span><a class="headerlink" href="#pyreduce.reduce.Flat.savefile" title="Link to this definition">¶</a></dt>
<dd><p>Name of master bias fits file</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.reduce.LaserFrequencyCombFinalize">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.reduce.</span></span><span class="sig-name descname"><span class="pre">LaserFrequencyCombFinalize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#LaserFrequencyCombFinalize"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.LaserFrequencyCombFinalize" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyreduce.reduce.Step" title="pyreduce.reduce.Step"><code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code></a></p>
<p>Improve the precision of the wavelength calibration with a laser frequency comb</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.LaserFrequencyCombFinalize.degree">
<span class="sig-name descname"><span class="pre">degree</span></span><a class="headerlink" href="#pyreduce.reduce.LaserFrequencyCombFinalize.degree" title="Link to this definition">¶</a></dt>
<dd><p>polynomial degree of the wavelength fit</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple(int, int)</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.LaserFrequencyCombFinalize.dimensionality">
<span class="sig-name descname"><span class="pre">dimensionality</span></span><a class="headerlink" href="#pyreduce.reduce.LaserFrequencyCombFinalize.dimensionality" title="Link to this definition">¶</a></dt>
<dd><p>Whether to use 1D or 2D polynomials</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>{‘1D’, ‘2D’}</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.LaserFrequencyCombFinalize.lfc_peak_width">
<span class="sig-name descname"><span class="pre">lfc_peak_width</span></span><a class="headerlink" href="#pyreduce.reduce.LaserFrequencyCombFinalize.lfc_peak_width" title="Link to this definition">¶</a></dt>
<dd><p>Width of the peaks for finding them in the spectrum</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.LaserFrequencyCombFinalize.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wavecal</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#LaserFrequencyCombFinalize.load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.LaserFrequencyCombFinalize.load" title="Link to this definition">¶</a></dt>
<dd><p>Load the results of the frequency comb improvement if possible,
otherwise just use the normal wavelength solution</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>wavecal</strong> (<em>tuple</em>) – results from the wavelength calibration step</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>wave</strong> (<em>array of shape (nord, ncol)</em>) – improved wavelength solution</p></li>
<li><p><strong>comb</strong> (<em>array of shape (nord, ncol)</em>) – extracted frequency comb image</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.LaserFrequencyCombFinalize.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">freq_comb_master</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wavecal</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#LaserFrequencyCombFinalize.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.LaserFrequencyCombFinalize.run" title="Link to this definition">¶</a></dt>
<dd><p>Improve the wavelength calibration with a laser frequency comb (or similar)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>files</strong> (<em>list</em><em>(</em><em>str</em><em>)</em>) – observation files</p></li>
<li><p><strong>wavecal</strong> (<em>tuple</em><em>(</em><em>)</em>) – results from the wavelength calibration step</p></li>
<li><p><strong>orders</strong> (<em>tuple</em>) – results from the order tracing step</p></li>
<li><p><strong>mask</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nrow</em><em>, </em><em>ncol</em><em>)</em>) – Bad pixel mask</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>wave</strong> (<em>array of shape (nord, ncol)</em>) – improved wavelength solution</p></li>
<li><p><strong>comb</strong> (<em>array of shape (nord, ncol)</em>) – extracted frequency comb image</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.LaserFrequencyCombFinalize.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wave</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#LaserFrequencyCombFinalize.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.LaserFrequencyCombFinalize.save" title="Link to this definition">¶</a></dt>
<dd><p>Save the results of the frequency comb improvement</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>wave</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em>) – improved wavelength solution</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.reduce.LaserFrequencyCombFinalize.savefile">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">savefile</span></span><a class="headerlink" href="#pyreduce.reduce.LaserFrequencyCombFinalize.savefile" title="Link to this definition">¶</a></dt>
<dd><p>Name of the wavelength echelle file</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.LaserFrequencyCombFinalize.threshold">
<span class="sig-name descname"><span class="pre">threshold</span></span><a class="headerlink" href="#pyreduce.reduce.LaserFrequencyCombFinalize.threshold" title="Link to this definition">¶</a></dt>
<dd><p>residual threshold in m/s above which to remove lines</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.reduce.LaserFrequencyCombMaster">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.reduce.</span></span><span class="sig-name descname"><span class="pre">LaserFrequencyCombMaster</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#LaserFrequencyCombMaster"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.LaserFrequencyCombMaster" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyreduce.reduce.CalibrationStep" title="pyreduce.reduce.CalibrationStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">CalibrationStep</span></code></a>, <a class="reference internal" href="#pyreduce.reduce.ExtractionStep" title="pyreduce.reduce.ExtractionStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExtractionStep</span></code></a></p>
<p>Create a laser frequency comb (or similar) master image</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.LaserFrequencyCombMaster.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#LaserFrequencyCombMaster.load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.LaserFrequencyCombMaster.load" title="Link to this definition">¶</a></dt>
<dd><p>Load master comb from disk</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>comb</strong> (<em>masked array of shape (nrow, ncol)</em>) – Master comb with bad pixel map applied</p></li>
<li><p><strong>chead</strong> (<em>FITS header</em>) – Master comb FITS header</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.LaserFrequencyCombMaster.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">curvature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm_flat</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#LaserFrequencyCombMaster.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.LaserFrequencyCombMaster.run" title="Link to this definition">¶</a></dt>
<dd><p>Improve the wavelength calibration with a laser frequency comb (or similar)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>files</strong> (<em>list</em><em>(</em><em>str</em><em>)</em>) – observation files</p></li>
<li><p><strong>orders</strong> (<em>tuple</em>) – results from the order tracing step</p></li>
<li><p><strong>mask</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nrow</em><em>, </em><em>ncol</em><em>)</em>) – Bad pixel mask</p></li>
<li><p><strong>curvature</strong> (<em>tuple</em>) – results from the curvature step</p></li>
<li><p><strong>bias</strong> (<em>tuple</em>) – results from the bias step</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>comb</strong> (<em>array of shape (nord, ncol)</em>) – extracted frequency comb image</p></li>
<li><p><strong>chead</strong> (<em>Header</em>) – FITS header of the combined image</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.LaserFrequencyCombMaster.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">comb</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chead</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#LaserFrequencyCombMaster.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.LaserFrequencyCombMaster.save" title="Link to this definition">¶</a></dt>
<dd><p>Save the master comb to a FITS file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>comb</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nrow</em><em>, </em><em>ncol</em><em>)</em>) – master comb data</p></li>
<li><p><strong>chead</strong> (<em>FITS header</em>) – master comb header</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.reduce.LaserFrequencyCombMaster.savefile">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">savefile</span></span><a class="headerlink" href="#pyreduce.reduce.LaserFrequencyCombMaster.savefile" title="Link to this definition">¶</a></dt>
<dd><p>Name of the wavelength echelle file</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.reduce.Mask">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.reduce.</span></span><span class="sig-name descname"><span class="pre">Mask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#Mask"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.Mask" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyreduce.reduce.Step" title="pyreduce.reduce.Step"><code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code></a></p>
<p>Load the bad pixel mask for the given instrument/mode</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.Mask.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#Mask.load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.Mask.load" title="Link to this definition">¶</a></dt>
<dd><p>Load the mask file from disk</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>mask</strong> – Bad pixel mask for this setting</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>array of shape (nrow, ncol)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.Mask.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#Mask.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.Mask.run" title="Link to this definition">¶</a></dt>
<dd><p>Load the mask file from disk</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>mask</strong> – Bad pixel mask for this setting</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>array of shape (nrow, ncol)</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.reduce.NormalizeFlatField">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.reduce.</span></span><span class="sig-name descname"><span class="pre">NormalizeFlatField</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#NormalizeFlatField"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.NormalizeFlatField" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyreduce.reduce.Step" title="pyreduce.reduce.Step"><code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code></a></p>
<p>Calculate the ‘normalized’ flat field image</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.NormalizeFlatField.extraction_kwargs">
<span class="sig-name descname"><span class="pre">extraction_kwargs</span></span><a class="headerlink" href="#pyreduce.reduce.NormalizeFlatField.extraction_kwargs" title="Link to this definition">¶</a></dt>
<dd><p>arguments for the extraction</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.NormalizeFlatField.extraction_method">
<span class="sig-name descname"><span class="pre">extraction_method</span></span><a class="headerlink" href="#pyreduce.reduce.NormalizeFlatField.extraction_method" title="Link to this definition">¶</a></dt>
<dd><p>Extraction method to use</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>{‘normalize’}</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.NormalizeFlatField.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#NormalizeFlatField.load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.NormalizeFlatField.load" title="Link to this definition">¶</a></dt>
<dd><p>Load normalized flat field results from disk</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>norm</strong> (<em>array of shape (nrow, ncol)</em>) – normalized flat field</p></li>
<li><p><strong>blaze</strong> (<em>array of shape (nord, ncol)</em>) – Continuum level as determined from the flat field for each order</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.NormalizeFlatField.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">flat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scatter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">curvature</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#NormalizeFlatField.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.NormalizeFlatField.run" title="Link to this definition">¶</a></dt>
<dd><p>Calculate the ‘normalized’ flat field</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>flat</strong> (<em>tuple</em><em>(</em><em>array</em><em>, </em><em>header</em><em>)</em>) – Master flat, and its FITS header</p></li>
<li><p><strong>orders</strong> (<em>tuple</em><em>(</em><em>array</em><em>, </em><em>array</em><em>)</em>) – Polynomial coefficients for each order, and the first and last(+1) column containing signal</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>norm</strong> (<em>array of shape (nrow, ncol)</em>) – normalized flat field</p></li>
<li><p><strong>blaze</strong> (<em>array of shape (nord, ncol)</em>) – Continuum level as determined from the flat field for each order</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.NormalizeFlatField.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">norm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blaze</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#NormalizeFlatField.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.NormalizeFlatField.save" title="Link to this definition">¶</a></dt>
<dd><p>Save normalized flat field results to disk</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>norm</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nrow</em><em>, </em><em>ncol</em><em>)</em>) – normalized flat field</p></li>
<li><p><strong>blaze</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em>) – Continuum level as determined from the flat field for each order</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.reduce.NormalizeFlatField.savefile">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">savefile</span></span><a class="headerlink" href="#pyreduce.reduce.NormalizeFlatField.savefile" title="Link to this definition">¶</a></dt>
<dd><p>Name of the blaze file</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.NormalizeFlatField.threshold">
<span class="sig-name descname"><span class="pre">threshold</span></span><a class="headerlink" href="#pyreduce.reduce.NormalizeFlatField.threshold" title="Link to this definition">¶</a></dt>
<dd><p>Threshold of the normalized flat field (values below this are just 1)</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.reduce.OrderTracing">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.reduce.</span></span><span class="sig-name descname"><span class="pre">OrderTracing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#OrderTracing"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.OrderTracing" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyreduce.reduce.CalibrationStep" title="pyreduce.reduce.CalibrationStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">CalibrationStep</span></code></a></p>
<p>Determine the polynomial fits describing the pixel locations of each order</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.OrderTracing.border_width">
<span class="sig-name descname"><span class="pre">border_width</span></span><a class="headerlink" href="#pyreduce.reduce.OrderTracing.border_width" title="Link to this definition">¶</a></dt>
<dd><p>Number of pixels at the edge of the detector to ignore</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.OrderTracing.filter_size">
<span class="sig-name descname"><span class="pre">filter_size</span></span><a class="headerlink" href="#pyreduce.reduce.OrderTracing.filter_size" title="Link to this definition">¶</a></dt>
<dd><p>Size of the gaussian filter for smoothing</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.OrderTracing.fit_degree">
<span class="sig-name descname"><span class="pre">fit_degree</span></span><a class="headerlink" href="#pyreduce.reduce.OrderTracing.fit_degree" title="Link to this definition">¶</a></dt>
<dd><p>Polynomial degree of the fit to each order</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.OrderTracing.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#OrderTracing.load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.OrderTracing.load" title="Link to this definition">¶</a></dt>
<dd><p>Load order tracing results</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>orders</strong> (<em>array of shape (nord, ndegree+1)</em>) – polynomial coefficients for each order</p></li>
<li><p><strong>column_range</strong> (<em>array of shape (nord, 2)</em>) – first and last(+1) column that carries signal in each order</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.OrderTracing.manual">
<span class="sig-name descname"><span class="pre">manual</span></span><a class="headerlink" href="#pyreduce.reduce.OrderTracing.manual" title="Link to this definition">¶</a></dt>
<dd><p>Whether to use manual alignment</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.OrderTracing.min_cluster">
<span class="sig-name descname"><span class="pre">min_cluster</span></span><a class="headerlink" href="#pyreduce.reduce.OrderTracing.min_cluster" title="Link to this definition">¶</a></dt>
<dd><p>Minimum size of each cluster to be included in further processing</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.OrderTracing.min_width">
<span class="sig-name descname"><span class="pre">min_width</span></span><a class="headerlink" href="#pyreduce.reduce.OrderTracing.min_width" title="Link to this definition">¶</a></dt>
<dd><p>Minimum width of each cluster after mergin</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int, float</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.OrderTracing.noise">
<span class="sig-name descname"><span class="pre">noise</span></span><a class="headerlink" href="#pyreduce.reduce.OrderTracing.noise" title="Link to this definition">¶</a></dt>
<dd><p>Background noise value threshold</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.OrderTracing.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#OrderTracing.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.OrderTracing.run" title="Link to this definition">¶</a></dt>
<dd><p>Determine polynomial coefficients describing order locations</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>files</strong> (<em>list</em><em>(</em><em>str</em><em>)</em>) – Observation used for order tracing (should only have one element)</p></li>
<li><p><strong>mask</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nrow</em><em>, </em><em>ncol</em><em>)</em>) – Bad pixel mask</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>orders</strong> (<em>array of shape (nord, ndegree+1)</em>) – polynomial coefficients for each order</p></li>
<li><p><strong>column_range</strong> (<em>array of shape (nord, 2)</em>) – first and last(+1) column that carries signal in each order</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.OrderTracing.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column_range</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#OrderTracing.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.OrderTracing.save" title="Link to this definition">¶</a></dt>
<dd><p>Save order tracing results to disk</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>orders</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ndegree+1</em><em>)</em>) – polynomial coefficients</p></li>
<li><p><strong>column_range</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>2</em><em>)</em>) – first and last(+1) column that carry signal in each order</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.reduce.OrderTracing.savefile">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">savefile</span></span><a class="headerlink" href="#pyreduce.reduce.OrderTracing.savefile" title="Link to this definition">¶</a></dt>
<dd><p>Name of the order tracing file</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.reduce.RectifyImage">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.reduce.</span></span><span class="sig-name descname"><span class="pre">RectifyImage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#RectifyImage"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.RectifyImage" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyreduce.reduce.Step" title="pyreduce.reduce.Step"><code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code></a></p>
<p>Create a 2D image of the rectified orders</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.RectifyImage.filename">
<span class="sig-name descname"><span class="pre">filename</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#RectifyImage.filename"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.RectifyImage.filename" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.RectifyImage.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#RectifyImage.load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.RectifyImage.load" title="Link to this definition">¶</a></dt>
<dd><p>Load results from a previous execution</p>
<p>If this raises a FileNotFoundError, run() will be used instead
For calibration steps it is preferred however to print a warning
and return None. Other modules can then use a default value instead.</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>NotImplementedError</strong> – Needs to be implemented for each step</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.RectifyImage.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">curvature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq_comb</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#RectifyImage.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.RectifyImage.run" title="Link to this definition">¶</a></dt>
<dd><p>Execute the current step</p>
<p>This should fail if files are missing or anything else goes wrong.
If the user does not want to run this step, they should not specify it in steps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>files</strong> (<em>list</em><em>(</em><em>str</em><em>)</em>) – data files required for this step</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>NotImplementedError</strong> – needs to be implemented for each step</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.RectifyImage.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wavelength</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">header</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#RectifyImage.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.RectifyImage.save" title="Link to this definition">¶</a></dt>
<dd><p>Save the results of this step</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>*args</strong> (<em>obj</em>) – things to save</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>NotImplementedError</strong> – Needs to be implemented for each step</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.reduce.Reducer">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.reduce.</span></span><span class="sig-name descname"><span class="pre">Reducer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">instrument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">night</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_existing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#Reducer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.Reducer" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.Reducer.files">
<span class="sig-name descname"><span class="pre">files</span></span><a class="headerlink" href="#pyreduce.reduce.Reducer.files" title="Link to this definition">¶</a></dt>
<dd><p>Filenames sorted by usecase</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict(str</p>
</dd>
<dt class="field-even">Type<span class="colon">:</span></dt>
<dd class="field-even"><p>str)</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.Reducer.modules">
<span class="sig-name descname"><span class="pre">modules</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{'bias':</span> <span class="pre">&lt;class</span> <span class="pre">'pyreduce.reduce.Bias'&gt;,</span> <span class="pre">'continuum':</span> <span class="pre">&lt;class</span> <span class="pre">'pyreduce.reduce.ContinuumNormalization'&gt;,</span> <span class="pre">'curvature':</span> <span class="pre">&lt;class</span> <span class="pre">'pyreduce.reduce.SlitCurvatureDetermination'&gt;,</span> <span class="pre">'finalize':</span> <span class="pre">&lt;class</span> <span class="pre">'pyreduce.reduce.Finalize'&gt;,</span> <span class="pre">'flat':</span> <span class="pre">&lt;class</span> <span class="pre">'pyreduce.reduce.Flat'&gt;,</span> <span class="pre">'freq_comb':</span> <span class="pre">&lt;class</span> <span class="pre">'pyreduce.reduce.LaserFrequencyCombFinalize'&gt;,</span> <span class="pre">'freq_comb_master':</span> <span class="pre">&lt;class</span> <span class="pre">'pyreduce.reduce.LaserFrequencyCombMaster'&gt;,</span> <span class="pre">'mask':</span> <span class="pre">&lt;class</span> <span class="pre">'pyreduce.reduce.Mask'&gt;,</span> <span class="pre">'norm_flat':</span> <span class="pre">&lt;class</span> <span class="pre">'pyreduce.reduce.NormalizeFlatField'&gt;,</span> <span class="pre">'orders':</span> <span class="pre">&lt;class</span> <span class="pre">'pyreduce.reduce.OrderTracing'&gt;,</span> <span class="pre">'rectify':</span> <span class="pre">&lt;class</span> <span class="pre">'pyreduce.reduce.RectifyImage'&gt;,</span> <span class="pre">'scatter':</span> <span class="pre">&lt;class</span> <span class="pre">'pyreduce.reduce.BackgroundScatter'&gt;,</span> <span class="pre">'science':</span> <span class="pre">&lt;class</span> <span class="pre">'pyreduce.reduce.ScienceExtraction'&gt;,</span> <span class="pre">'wavecal':</span> <span class="pre">&lt;class</span> <span class="pre">'pyreduce.reduce.WavelengthCalibrationFinalize'&gt;,</span> <span class="pre">'wavecal_init':</span> <span class="pre">&lt;class</span> <span class="pre">'pyreduce.reduce.WavelengthCalibrationInitialize'&gt;,</span> <span class="pre">'wavecal_master':</span> <span class="pre">&lt;class</span> <span class="pre">'pyreduce.reduce.WavelengthCalibrationMaster'&gt;}</span></em><a class="headerlink" href="#pyreduce.reduce.Reducer.modules" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.Reducer.prepare_output_dir">
<span class="sig-name descname"><span class="pre">prepare_output_dir</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#Reducer.prepare_output_dir"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.Reducer.prepare_output_dir" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.Reducer.run_module">
<span class="sig-name descname"><span class="pre">run_module</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">step</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#Reducer.run_module"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.Reducer.run_module" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.Reducer.run_steps">
<span class="sig-name descname"><span class="pre">run_steps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">steps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'all'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#Reducer.run_steps"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.Reducer.run_steps" title="Link to this definition">¶</a></dt>
<dd><p>Execute the steps as required</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>steps</strong> (<em>{tuple</em><em>(</em><em>str</em><em>)</em><em>, </em><em>&quot;all&quot;}</em><em>, </em><em>optional</em>) – which steps of the reduction process to perform
the possible steps are: “bias”, “flat”, “orders”, “norm_flat”, “wavecal”, “freq_comb”,
“curvature”, “science”, “continuum”, “finalize”
alternatively set steps to “all”, which is equivalent to setting all steps</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.Reducer.step_order">
<span class="sig-name descname"><span class="pre">step_order</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{'bias':</span> <span class="pre">10,</span> <span class="pre">'continuum':</span> <span class="pre">90,</span> <span class="pre">'curvature':</span> <span class="pre">40,</span> <span class="pre">'finalize':</span> <span class="pre">100,</span> <span class="pre">'flat':</span> <span class="pre">20,</span> <span class="pre">'freq_comb':</span> <span class="pre">72,</span> <span class="pre">'freq_comb_master':</span> <span class="pre">70,</span> <span class="pre">'norm_flat':</span> <span class="pre">50,</span> <span class="pre">'orders':</span> <span class="pre">30,</span> <span class="pre">'rectify':</span> <span class="pre">75,</span> <span class="pre">'scatter':</span> <span class="pre">45,</span> <span class="pre">'science':</span> <span class="pre">80,</span> <span class="pre">'wavecal':</span> <span class="pre">67,</span> <span class="pre">'wavecal_init':</span> <span class="pre">64,</span> <span class="pre">'wavecal_master':</span> <span class="pre">60}</span></em><a class="headerlink" href="#pyreduce.reduce.Reducer.step_order" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.reduce.ScienceExtraction">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.reduce.</span></span><span class="sig-name descname"><span class="pre">ScienceExtraction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#ScienceExtraction"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.ScienceExtraction" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyreduce.reduce.CalibrationStep" title="pyreduce.reduce.CalibrationStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">CalibrationStep</span></code></a>, <a class="reference internal" href="#pyreduce.reduce.ExtractionStep" title="pyreduce.reduce.ExtractionStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExtractionStep</span></code></a></p>
<p>Extract the science spectra</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.ScienceExtraction.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#ScienceExtraction.load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.ScienceExtraction.load" title="Link to this definition">¶</a></dt>
<dd><p>Load all science spectra from disk</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>heads</strong> (<em>list(FITS header)</em>) – FITS headers of each observation</p></li>
<li><p><strong>specs</strong> (<em>list(array of shape (nord, ncol))</em>) – extracted spectra</p></li>
<li><p><strong>sigmas</strong> (<em>list(array of shape (nord, ncol))</em>) – uncertainties of the extracted spectra</p></li>
<li><p><strong>columns</strong> (<em>list(array of shape (nord, 2))</em>) – column ranges for each spectra</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.ScienceExtraction.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm_flat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">curvature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scatter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#ScienceExtraction.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.ScienceExtraction.run" title="Link to this definition">¶</a></dt>
<dd><p>Extract Science spectra from observation</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>files</strong> (<em>list</em><em>(</em><em>str</em><em>)</em>) – list of observations</p></li>
<li><p><strong>bias</strong> (<em>tuple</em>) – results from master bias step</p></li>
<li><p><strong>orders</strong> (<em>tuple</em>) – results from order tracing step</p></li>
<li><p><strong>norm_flat</strong> (<em>tuple</em>) – results from flat normalization</p></li>
<li><p><strong>curvature</strong> (<em>tuple</em>) – results from slit curvature step</p></li>
<li><p><strong>mask</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nrow</em><em>, </em><em>ncol</em><em>)</em>) – bad pixel map</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>heads</strong> (<em>list(FITS header)</em>) – FITS headers of each observation</p></li>
<li><p><strong>specs</strong> (<em>list(array of shape (nord, ncol))</em>) – extracted spectra</p></li>
<li><p><strong>sigmas</strong> (<em>list(array of shape (nord, ncol))</em>) – uncertainties of the extracted spectra</p></li>
<li><p><strong>slitfu</strong> (<em>list(array of shape (nord, (extr_height*oversample+1)+1)</em>) – slit illumination function</p></li>
<li><p><strong>columns</strong> (<em>list(array of shape (nord, 2))</em>) – column ranges for each spectra</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.ScienceExtraction.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">head</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slitfu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column_range</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#ScienceExtraction.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.ScienceExtraction.save" title="Link to this definition">¶</a></dt>
<dd><p>Save the results of one extraction</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fname</strong> (<em>str</em>) – filename to save to</p></li>
<li><p><strong>head</strong> (<em>FITS header</em>) – FITS header</p></li>
<li><p><strong>spec</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em>) – extracted spectrum</p></li>
<li><p><strong>sigma</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em>) – uncertainties of the extracted spectrum</p></li>
<li><p><strong>slitfu</strong> (<em>list</em><em>(</em><em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>(</em><em>extr_height*oversample+1</em><em>)</em><em>+1</em><em>)</em>) – slit illumination function</p></li>
<li><p><strong>column_range</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>2</em><em>)</em>) – range of columns that have spectrum</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.ScienceExtraction.science_file">
<span class="sig-name descname"><span class="pre">science_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#ScienceExtraction.science_file"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.ScienceExtraction.science_file" title="Link to this definition">¶</a></dt>
<dd><p>Name of the science file in disk, based on the input file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>name</strong> (<em>str</em>) – name of the observation file</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>name</strong> – science file name</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.reduce.SlitCurvatureDetermination">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.reduce.</span></span><span class="sig-name descname"><span class="pre">SlitCurvatureDetermination</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#SlitCurvatureDetermination"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.SlitCurvatureDetermination" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyreduce.reduce.CalibrationStep" title="pyreduce.reduce.CalibrationStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">CalibrationStep</span></code></a>, <a class="reference internal" href="#pyreduce.reduce.ExtractionStep" title="pyreduce.reduce.ExtractionStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExtractionStep</span></code></a></p>
<p>Determine the curvature of the slit</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.SlitCurvatureDetermination.curv_degree">
<span class="sig-name descname"><span class="pre">curv_degree</span></span><a class="headerlink" href="#pyreduce.reduce.SlitCurvatureDetermination.curv_degree" title="Link to this definition">¶</a></dt>
<dd><p>Orders of the curvature to fit, currently supports only 1 and 2</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.SlitCurvatureDetermination.curvature_mode">
<span class="sig-name descname"><span class="pre">curvature_mode</span></span><a class="headerlink" href="#pyreduce.reduce.SlitCurvatureDetermination.curvature_mode" title="Link to this definition">¶</a></dt>
<dd><p>Whether to use 1d or 2d polynomials</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>{‘1D’, ‘2D’}</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.SlitCurvatureDetermination.extraction_width">
<span class="sig-name descname"><span class="pre">extraction_width</span></span><a class="headerlink" href="#pyreduce.reduce.SlitCurvatureDetermination.extraction_width" title="Link to this definition">¶</a></dt>
<dd><p>width of the orders in the extraction</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.SlitCurvatureDetermination.fit_degree">
<span class="sig-name descname"><span class="pre">fit_degree</span></span><a class="headerlink" href="#pyreduce.reduce.SlitCurvatureDetermination.fit_degree" title="Link to this definition">¶</a></dt>
<dd><p>Polynomial degree of the overall fit</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.SlitCurvatureDetermination.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#SlitCurvatureDetermination.load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.SlitCurvatureDetermination.load" title="Link to this definition">¶</a></dt>
<dd><p>Load the curvature if possible, otherwise return None, None, i.e. use vertical extraction</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>tilt</strong> (<em>array of shape (nord, ncol)</em>) – first order slit curvature at each point</p></li>
<li><p><strong>shear</strong> (<em>array of shape (nord, ncol)</em>) – second order slit curvature at each point</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.SlitCurvatureDetermination.peak_function">
<span class="sig-name descname"><span class="pre">peak_function</span></span><a class="headerlink" href="#pyreduce.reduce.SlitCurvatureDetermination.peak_function" title="Link to this definition">¶</a></dt>
<dd><p>Function shape that is fit to individual peaks</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.SlitCurvatureDetermination.peak_threshold">
<span class="sig-name descname"><span class="pre">peak_threshold</span></span><a class="headerlink" href="#pyreduce.reduce.SlitCurvatureDetermination.peak_threshold" title="Link to this definition">¶</a></dt>
<dd><p>peak finding noise threshold</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.SlitCurvatureDetermination.peak_width">
<span class="sig-name descname"><span class="pre">peak_width</span></span><a class="headerlink" href="#pyreduce.reduce.SlitCurvatureDetermination.peak_width" title="Link to this definition">¶</a></dt>
<dd><p>peak width</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.SlitCurvatureDetermination.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#SlitCurvatureDetermination.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.SlitCurvatureDetermination.run" title="Link to this definition">¶</a></dt>
<dd><p>Determine the curvature of the slit</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>files</strong> (<em>list</em><em>(</em><em>str</em><em>)</em>) – files to use for this</p></li>
<li><p><strong>orders</strong> (<em>tuple</em>) – results of the order tracing</p></li>
<li><p><strong>mask</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nrow</em><em>, </em><em>ncol</em><em>)</em>) – Bad pixel mask</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>tilt</strong> (<em>array of shape (nord, ncol)</em>) – first order slit curvature at each point</p></li>
<li><p><strong>shear</strong> (<em>array of shape (nord, ncol)</em>) – second order slit curvature at each point</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.SlitCurvatureDetermination.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tilt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shear</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#SlitCurvatureDetermination.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.SlitCurvatureDetermination.save" title="Link to this definition">¶</a></dt>
<dd><p>Save results from the curvature</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tilt</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em>) – first order slit curvature at each point</p></li>
<li><p><strong>shear</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em>) – second order slit curvature at each point</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.reduce.SlitCurvatureDetermination.savefile">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">savefile</span></span><a class="headerlink" href="#pyreduce.reduce.SlitCurvatureDetermination.savefile" title="Link to this definition">¶</a></dt>
<dd><p>Name of the tilt/shear save file</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.SlitCurvatureDetermination.sigma_cutoff">
<span class="sig-name descname"><span class="pre">sigma_cutoff</span></span><a class="headerlink" href="#pyreduce.reduce.SlitCurvatureDetermination.sigma_cutoff" title="Link to this definition">¶</a></dt>
<dd><p>how many sigma of bad lines to cut away</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.SlitCurvatureDetermination.window_width">
<span class="sig-name descname"><span class="pre">window_width</span></span><a class="headerlink" href="#pyreduce.reduce.SlitCurvatureDetermination.window_width" title="Link to this definition">¶</a></dt>
<dd><p>window width to search for peak in each row</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.reduce.Step">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.reduce.</span></span><span class="sig-name descname"><span class="pre">Step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instrument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">night</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order_range</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#Step"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.Step" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Parent class for all steps</p>
<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.reduce.Step.dependsOn">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">dependsOn</span></span><a class="headerlink" href="#pyreduce.reduce.Step.dependsOn" title="Link to this definition">¶</a></dt>
<dd><p>Steps that are required before running this step</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list(str)</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.Step.instrument">
<span class="sig-name descname"><span class="pre">instrument</span></span><a class="headerlink" href="#pyreduce.reduce.Step.instrument" title="Link to this definition">¶</a></dt>
<dd><p>Name of the instrument</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.Step.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#Step.load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.Step.load" title="Link to this definition">¶</a></dt>
<dd><p>Load results from a previous execution</p>
<p>If this raises a FileNotFoundError, run() will be used instead
For calibration steps it is preferred however to print a warning
and return None. Other modules can then use a default value instead.</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>NotImplementedError</strong> – Needs to be implemented for each step</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.reduce.Step.loadDependsOn">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">loadDependsOn</span></span><a class="headerlink" href="#pyreduce.reduce.Step.loadDependsOn" title="Link to this definition">¶</a></dt>
<dd><p>Steps that are required before loading data from this step</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list(str)</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.Step.mode">
<span class="sig-name descname"><span class="pre">mode</span></span><a class="headerlink" href="#pyreduce.reduce.Step.mode" title="Link to this definition">¶</a></dt>
<dd><p>Name of the instrument mode</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.Step.night">
<span class="sig-name descname"><span class="pre">night</span></span><a class="headerlink" href="#pyreduce.reduce.Step.night" title="Link to this definition">¶</a></dt>
<dd><p>Date of the observation (as a string)</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.Step.order_range">
<span class="sig-name descname"><span class="pre">order_range</span></span><a class="headerlink" href="#pyreduce.reduce.Step.order_range" title="Link to this definition">¶</a></dt>
<dd><p>First and Last(+1) order to process</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple(int, int)</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.reduce.Step.output_dir">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">output_dir</span></span><a class="headerlink" href="#pyreduce.reduce.Step.output_dir" title="Link to this definition">¶</a></dt>
<dd><p>output directory, may contain tags {instrument}, {night}, {target}, {mode}</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.Step.plot">
<span class="sig-name descname"><span class="pre">plot</span></span><a class="headerlink" href="#pyreduce.reduce.Step.plot" title="Link to this definition">¶</a></dt>
<dd><p>Whether to plot the results or the progress of this step</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.Step.plot_title">
<span class="sig-name descname"><span class="pre">plot_title</span></span><a class="headerlink" href="#pyreduce.reduce.Step.plot_title" title="Link to this definition">¶</a></dt>
<dd><p>Title used in the plots, if any</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.reduce.Step.prefix">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">prefix</span></span><a class="headerlink" href="#pyreduce.reduce.Step.prefix" title="Link to this definition">¶</a></dt>
<dd><p>temporary file prefix</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.Step.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#Step.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.Step.run" title="Link to this definition">¶</a></dt>
<dd><p>Execute the current step</p>
<p>This should fail if files are missing or anything else goes wrong.
If the user does not want to run this step, they should not specify it in steps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>files</strong> (<em>list</em><em>(</em><em>str</em><em>)</em>) – data files required for this step</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>NotImplementedError</strong> – needs to be implemented for each step</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.Step.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#Step.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.Step.save" title="Link to this definition">¶</a></dt>
<dd><p>Save the results of this step</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>*args</strong> (<em>obj</em>) – things to save</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>NotImplementedError</strong> – Needs to be implemented for each step</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.Step.target">
<span class="sig-name descname"><span class="pre">target</span></span><a class="headerlink" href="#pyreduce.reduce.Step.target" title="Link to this definition">¶</a></dt>
<dd><p>Name of the observation target</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationFinalize">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.reduce.</span></span><span class="sig-name descname"><span class="pre">WavelengthCalibrationFinalize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#WavelengthCalibrationFinalize"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationFinalize" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyreduce.reduce.Step" title="pyreduce.reduce.Step"><code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code></a></p>
<p>Perform wavelength calibration</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationFinalize.correlate_cols">
<span class="sig-name descname"><span class="pre">correlate_cols</span></span><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationFinalize.correlate_cols" title="Link to this definition">¶</a></dt>
<dd><p>How many columns to use in the 2D cross correlation alignment. 0 means all pixels (slow).</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationFinalize.degree">
<span class="sig-name descname"><span class="pre">degree</span></span><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationFinalize.degree" title="Link to this definition">¶</a></dt>
<dd><p>Polynomial degree of the wavelength calibration in order, column direction</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple(int, int)</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationFinalize.dimensionality">
<span class="sig-name descname"><span class="pre">dimensionality</span></span><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationFinalize.dimensionality" title="Link to this definition">¶</a></dt>
<dd><p>Whether to use 1d or 2d polynomials</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>{‘1D’, ‘2D’}</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationFinalize.element">
<span class="sig-name descname"><span class="pre">element</span></span><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationFinalize.element" title="Link to this definition">¶</a></dt>
<dd><p>elements of the spectral lamp</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationFinalize.iterations">
<span class="sig-name descname"><span class="pre">iterations</span></span><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationFinalize.iterations" title="Link to this definition">¶</a></dt>
<dd><p>Number of iterations in the remove lines, auto id cycle</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationFinalize.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#WavelengthCalibrationFinalize.load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationFinalize.load" title="Link to this definition">¶</a></dt>
<dd><p>Load the results of the wavelength calibration</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>wave</strong> (<em>array of shape (nord, ncol)</em>) – wavelength for each point in the spectrum</p></li>
<li><p><strong>coef</strong> (<em>array of shape (*ndegrees,)</em>) – polynomial coefficients of the wavelength fit</p></li>
<li><p><strong>linelist</strong> (<em>record array of shape (nlines,)</em>) – Updated line information for all lines</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationFinalize.manual">
<span class="sig-name descname"><span class="pre">manual</span></span><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationFinalize.manual" title="Link to this definition">¶</a></dt>
<dd><p>Whether to use manual alignment instead of cross correlation</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationFinalize.medium">
<span class="sig-name descname"><span class="pre">medium</span></span><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationFinalize.medium" title="Link to this definition">¶</a></dt>
<dd><p>medium of the detector, vac or air</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationFinalize.nstep">
<span class="sig-name descname"><span class="pre">nstep</span></span><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationFinalize.nstep" title="Link to this definition">¶</a></dt>
<dd><p>Number of detector offset steps, due to detector design</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationFinalize.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wavecal_master</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wavecal_init</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#WavelengthCalibrationFinalize.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationFinalize.run" title="Link to this definition">¶</a></dt>
<dd><p>Perform wavelength calibration</p>
<p>This consists of extracting the wavelength image
and fitting a polynomial the the known spectral lines</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wavecal_master</strong> (<em>tuple</em>) – results of the wavecal_master step, containing the master wavecal image
and its header</p></li>
<li><p><strong>wavecal_init</strong> (<a class="reference internal" href="#pyreduce.wavelength_calibration.LineList" title="pyreduce.wavelength_calibration.LineList"><em>LineList</em></a>) – the initial LineList guess with the positions and wavelengths of lines</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>wave</strong> (<em>array of shape (nord, ncol)</em>) – wavelength for each point in the spectrum</p></li>
<li><p><strong>coef</strong> (<em>array of shape (*ndegrees,)</em>) – polynomial coefficients of the wavelength fit</p></li>
<li><p><strong>linelist</strong> (<em>record array of shape (nlines,)</em>) – Updated line information for all lines</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationFinalize.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wave</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coef</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">linelist</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#WavelengthCalibrationFinalize.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationFinalize.save" title="Link to this definition">¶</a></dt>
<dd><p>Save the results of the wavelength calibration</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wave</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em>) – wavelength for each point in the spectrum</p></li>
<li><p><strong>coef</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>ndegrees</em><em>,</em><em>)</em>) – polynomial coefficients of the wavelength fit</p></li>
<li><p><strong>linelist</strong> (<em>record array</em><em> of </em><em>shape</em><em> (</em><em>nlines</em><em>,</em><em>)</em>) – Updated line information for all lines</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationFinalize.savefile">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">savefile</span></span><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationFinalize.savefile" title="Link to this definition">¶</a></dt>
<dd><p>Name of the wavelength echelle file</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationFinalize.shift_window">
<span class="sig-name descname"><span class="pre">shift_window</span></span><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationFinalize.shift_window" title="Link to this definition">¶</a></dt>
<dd><p>fraction of columns, to allow individual orders to shift</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationFinalize.threshold">
<span class="sig-name descname"><span class="pre">threshold</span></span><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationFinalize.threshold" title="Link to this definition">¶</a></dt>
<dd><p>residual threshold in m/s</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationInitialize">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.reduce.</span></span><span class="sig-name descname"><span class="pre">WavelengthCalibrationInitialize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#WavelengthCalibrationInitialize"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationInitialize" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyreduce.reduce.Step" title="pyreduce.reduce.Step"><code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code></a></p>
<p>Create the initial wavelength solution file</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationInitialize.cutoff">
<span class="sig-name descname"><span class="pre">cutoff</span></span><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationInitialize.cutoff" title="Link to this definition">¶</a></dt>
<dd><p>Minimum height of spectral lines in the normalized spectrum, values of 1 and above are interpreted as percentiles of the spectrum, set to 0 to disable the cutoff</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationInitialize.degree">
<span class="sig-name descname"><span class="pre">degree</span></span><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationInitialize.degree" title="Link to this definition">¶</a></dt>
<dd><p>Polynomial degree of the wavelength calibration in order, column direction</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple(int, int)</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationInitialize.element">
<span class="sig-name descname"><span class="pre">element</span></span><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationInitialize.element" title="Link to this definition">¶</a></dt>
<dd><p>element for the atlas to use</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationInitialize.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wavecal_master</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#WavelengthCalibrationInitialize.load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationInitialize.load" title="Link to this definition">¶</a></dt>
<dd><p>Load results from a previous execution</p>
<p>If this raises a FileNotFoundError, run() will be used instead
For calibration steps it is preferred however to print a warning
and return None. Other modules can then use a default value instead.</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>NotImplementedError</strong> – Needs to be implemented for each step</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationInitialize.medium">
<span class="sig-name descname"><span class="pre">medium</span></span><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationInitialize.medium" title="Link to this definition">¶</a></dt>
<dd><p>medium the medium of the instrument, air or vac</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationInitialize.nwalkers">
<span class="sig-name descname"><span class="pre">nwalkers</span></span><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationInitialize.nwalkers" title="Link to this definition">¶</a></dt>
<dd><p>number of walkers in the MCMC</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationInitialize.resid_delta">
<span class="sig-name descname"><span class="pre">resid_delta</span></span><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationInitialize.resid_delta" title="Link to this definition">¶</a></dt>
<dd><p>resiudal range to accept as match between peaks and atlas in m/s</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationInitialize.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wavecal_master</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#WavelengthCalibrationInitialize.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationInitialize.run" title="Link to this definition">¶</a></dt>
<dd><p>Execute the current step</p>
<p>This should fail if files are missing or anything else goes wrong.
If the user does not want to run this step, they should not specify it in steps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>files</strong> (<em>list</em><em>(</em><em>str</em><em>)</em>) – data files required for this step</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>NotImplementedError</strong> – needs to be implemented for each step</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationInitialize.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">linelist</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#WavelengthCalibrationInitialize.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationInitialize.save" title="Link to this definition">¶</a></dt>
<dd><p>Save the results of this step</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>*args</strong> (<em>obj</em>) – things to save</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>NotImplementedError</strong> – Needs to be implemented for each step</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationInitialize.savefile">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">savefile</span></span><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationInitialize.savefile" title="Link to this definition">¶</a></dt>
<dd><p>Name of the wavelength echelle file</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationInitialize.smoothing">
<span class="sig-name descname"><span class="pre">smoothing</span></span><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationInitialize.smoothing" title="Link to this definition">¶</a></dt>
<dd><p>Gaussian smoothing parameter applied to the observed spectrum in pixel scale, set to 0 to disable smoothing</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationInitialize.steps">
<span class="sig-name descname"><span class="pre">steps</span></span><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationInitialize.steps" title="Link to this definition">¶</a></dt>
<dd><p>number of steps in the MCMC</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationInitialize.wave_delta">
<span class="sig-name descname"><span class="pre">wave_delta</span></span><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationInitialize.wave_delta" title="Link to this definition">¶</a></dt>
<dd><p>wavelength range around the initial guess to explore</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationMaster">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.reduce.</span></span><span class="sig-name descname"><span class="pre">WavelengthCalibrationMaster</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#WavelengthCalibrationMaster"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationMaster" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyreduce.reduce.CalibrationStep" title="pyreduce.reduce.CalibrationStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">CalibrationStep</span></code></a>, <a class="reference internal" href="#pyreduce.reduce.ExtractionStep" title="pyreduce.reduce.ExtractionStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExtractionStep</span></code></a></p>
<p>Create wavelength calibration master image</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationMaster.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#WavelengthCalibrationMaster.load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationMaster.load" title="Link to this definition">¶</a></dt>
<dd><p>Load master wavelength calibration from disk</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>thar</strong> (<em>masked array of shape (nrow, ncol)</em>) – Master wavecal with bad pixel map applied</p></li>
<li><p><strong>thead</strong> (<em>FITS header</em>) – Master wavecal FITS header</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationMaster.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">curvature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm_flat</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#WavelengthCalibrationMaster.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationMaster.run" title="Link to this definition">¶</a></dt>
<dd><p>Perform wavelength calibration</p>
<p>This consists of extracting the wavelength image
and fitting a polynomial the the known spectral lines</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>files</strong> (<em>list</em><em>(</em><em>str</em><em>)</em>) – wavelength calibration files</p></li>
<li><p><strong>orders</strong> (<em>tuple</em><em>(</em><em>array</em><em>, </em><em>array</em><em>)</em>) – Polynomial coefficients of each order, and columns with signal of each order</p></li>
<li><p><strong>mask</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nrow</em><em>, </em><em>ncol</em><em>)</em>) – Bad pixel mask</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>wave</strong> (<em>array of shape (nord, ncol)</em>) – wavelength for each point in the spectrum</p></li>
<li><p><strong>thar</strong> (<em>array of shape (nrow, ncol)</em>) – extracted wavelength calibration image</p></li>
<li><p><strong>coef</strong> (<em>array of shape (*ndegrees,)</em>) – polynomial coefficients of the wavelength fit</p></li>
<li><p><strong>linelist</strong> (<em>record array of shape (nlines,)</em>) – Updated line information for all lines</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationMaster.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">thar</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">thead</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#WavelengthCalibrationMaster.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationMaster.save" title="Link to this definition">¶</a></dt>
<dd><p>Save the master wavelength calibration to a FITS file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>thar</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nrow</em><em>, </em><em>ncol</em><em>)</em>) – master flat data</p></li>
<li><p><strong>thead</strong> (<em>FITS header</em>) – master flat header</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.reduce.WavelengthCalibrationMaster.savefile">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">savefile</span></span><a class="headerlink" href="#pyreduce.reduce.WavelengthCalibrationMaster.savefile" title="Link to this definition">¶</a></dt>
<dd><p>Name of the wavelength echelle file</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.reduce.main">
<span class="sig-prename descclassname"><span class="pre">pyreduce.reduce.</span></span><span class="sig-name descname"><span class="pre">main</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instrument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">night</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">modes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">steps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'all'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">base_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">configuration</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allow_calibration_only</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_existing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/reduce.html#main"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.reduce.main" title="Link to this definition">¶</a></dt>
<dd><p>Main entry point for REDUCE scripts,
default values can be changed as required if reduce is used as a script
Finds input directories, and loops over observation nights and instrument modes</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instrument</strong> (<em>str</em><em>, </em><em>list</em><em>[</em><em>str</em><em>]</em>) – instrument used for the observation (e.g. UVES, HARPS)</p></li>
<li><p><strong>target</strong> (<em>str</em><em>, </em><em>list</em><em>[</em><em>str</em><em>]</em>) – the observed star, as named in the folder structure/fits headers</p></li>
<li><p><strong>night</strong> (<em>str</em><em>, </em><em>list</em><em>[</em><em>str</em><em>]</em>) – the observation nights to reduce, as named in the folder structure. Accepts bash wildcards (i.e. *, ?), but then relies on the folder structure for restricting the nights</p></li>
<li><p><strong>modes</strong> (<em>str</em><em>, </em><em>list</em><em>[</em><em>str</em><em>]</em><em>, </em><em>dict</em><em>[</em><em>{instrument}:list</em><em>]</em><em>, </em><em>None</em><em>, </em><em>optional</em>) – the instrument modes to use, if None will use all known modes for the current instrument. See instruments for possible options</p></li>
<li><p><strong>steps</strong> (<em>tuple</em><em>(</em><em>str</em><em>)</em><em>, </em><em>&quot;all&quot;</em><em>, </em><em>optional</em>) – which steps of the reduction process to perform
the possible steps are: “bias”, “flat”, “orders”, “norm_flat”, “wavecal”, “science”
alternatively set steps to “all”, which is equivalent to setting all steps
Note that the later steps require the previous intermediary products to exist and raise an exception otherwise</p></li>
<li><p><strong>base_dir</strong> (<em>str</em><em>, </em><em>optional</em>) – base data directory that Reduce should work in, is prefixxed on input_dir and output_dir (default: use settings_pyreduce.json)</p></li>
<li><p><strong>input_dir</strong> (<em>str</em><em>, </em><em>optional</em>) – input directory containing raw files. Can contain placeholders {instrument}, {target}, {night}, {mode} as well as wildcards. If relative will use base_dir as root (default: use settings_pyreduce.json)</p></li>
<li><p><strong>output_dir</strong> (<em>str</em><em>, </em><em>optional</em>) – output directory for intermediary and final results. Can contain placeholders {instrument}, {target}, {night}, {mode}, but no wildcards. If relative will use base_dir as root (default: use settings_pyreduce.json)</p></li>
<li><p><strong>configuration</strong> (<em>dict</em><em>[</em><em>str:obj</em><em>]</em><em>, </em><em>str</em><em>, </em><em>list</em><em>[</em><em>str</em><em>]</em><em>, </em><em>dict</em><em>[</em><em>{instrument}:dict</em><em>,</em><em>str</em><em>]</em><em>, </em><em>optional</em>) – configuration file for the current run, contains parameters for different parts of reduce. Can be a path to a json file, or a dict with configurations for the different instruments. When a list, the order must be the same as instruments (default: settings_{instrument.upper()}.json)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-pyreduce.trace_orders">
<span id="pyreduce-trace-orders-module"></span><h2>pyreduce.trace_orders module<a class="headerlink" href="#module-pyreduce.trace_orders" title="Link to this heading">¶</a></h2>
<p>Find clusters of pixels with signal
And combine them into continous orders</p>
<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.trace_orders.best_fit">
<span class="sig-prename descclassname"><span class="pre">pyreduce.trace_orders.</span></span><span class="sig-name descname"><span class="pre">best_fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/trace_orders.html#best_fit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.trace_orders.best_fit" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.trace_orders.calculate_mean_cluster_thickness">
<span class="sig-prename descclassname"><span class="pre">pyreduce.trace_orders.</span></span><span class="sig-name descname"><span class="pre">calculate_mean_cluster_thickness</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/trace_orders.html#calculate_mean_cluster_thickness"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.trace_orders.calculate_mean_cluster_thickness" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.trace_orders.combine">
<span class="sig-prename descclassname"><span class="pre">pyreduce.trace_orders.</span></span><span class="sig-name descname"><span class="pre">combine</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">j</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">merge</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mct</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nrow</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ncol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/trace_orders.html#combine"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.trace_orders.combine" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.trace_orders.create_merge_array">
<span class="sig-prename descclassname"><span class="pre">pyreduce.trace_orders.</span></span><span class="sig-name descname"><span class="pre">create_merge_array</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_cluster_thickness</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nrow</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ncol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/trace_orders.html#create_merge_array"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.trace_orders.create_merge_array" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.trace_orders.delete">
<span class="sig-prename descclassname"><span class="pre">pyreduce.trace_orders.</span></span><span class="sig-name descname"><span class="pre">delete</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">merge</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/trace_orders.html#delete"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.trace_orders.delete" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.trace_orders.determine_overlap_rating">
<span class="sig-prename descclassname"><span class="pre">pyreduce.trace_orders.</span></span><span class="sig-name descname"><span class="pre">determine_overlap_rating</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xi</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">yi</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">yj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_cluster_thickness</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nrow</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ncol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/trace_orders.html#determine_overlap_rating"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.trace_orders.determine_overlap_rating" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.trace_orders.fit">
<span class="sig-prename descclassname"><span class="pre">pyreduce.trace_orders.</span></span><span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regularization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/trace_orders.html#fit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.trace_orders.fit" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.trace_orders.fit_polynomials_to_clusters">
<span class="sig-prename descclassname"><span class="pre">pyreduce.trace_orders.</span></span><span class="sig-name descname"><span class="pre">fit_polynomials_to_clusters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clusters</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degree</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regularization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/trace_orders.html#fit_polynomials_to_clusters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.trace_orders.fit_polynomials_to_clusters" title="Link to this definition">¶</a></dt>
<dd><p>Fits a polynomial of degree opower to points x, y in cluster clusters</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>dict</em><em>(</em><em>int: array</em><em>)</em>) – x coordinates seperated by cluster</p></li>
<li><p><strong>y</strong> (<em>dict</em><em>(</em><em>int: array</em><em>)</em>) – y coordinates seperated by cluster</p></li>
<li><p><strong>clusters</strong> (<em>list</em><em>(</em><em>int</em><em>)</em>) – cluster labels, equivalent to x.keys() or y.keys()</p></li>
<li><p><strong>degree</strong> (<em>int</em>) – degree of polynomial fit</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>orders</strong> – coefficients of polynomial fit for each cluster</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict(int, array[degree+1])</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.trace_orders.mark_orders">
<span class="sig-prename descclassname"><span class="pre">pyreduce.trace_orders.</span></span><span class="sig-name descname"><span class="pre">mark_orders</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_cluster</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opower</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">border_width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degree_before_merge</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regularization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">closing_shape</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(5,</span> <span class="pre">5)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opening_shape</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(2,</span> <span class="pre">2)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">manual</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">auto_merge_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.9</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">merge_min_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/trace_orders.html#mark_orders"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.trace_orders.mark_orders" title="Link to this definition">¶</a></dt>
<dd><p>Identify and trace orders</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>array</em><em>[</em><em>nrow</em><em>, </em><em>ncol</em><em>]</em>) – order definition image</p></li>
<li><p><strong>min_cluster</strong> (<em>int</em><em>, </em><em>optional</em>) – minimum cluster size in pixels (default: 500)</p></li>
<li><p><strong>filter_size</strong> (<em>int</em><em>, </em><em>optional</em>) – size of the running filter (default: 120)</p></li>
<li><p><strong>noise</strong> (<em>float</em><em>, </em><em>optional</em>) – noise to filter out (default: 8)</p></li>
<li><p><strong>opower</strong> (<em>int</em><em>, </em><em>optional</em>) – polynomial degree of the order fit (default: 4)</p></li>
<li><p><strong>border_width</strong> (<em>int</em><em>, </em><em>optional</em>) – number of pixels at the bottom and top borders of the image to ignore for order tracing (default: 5)</p></li>
<li><p><strong>plot</strong> (<em>bool</em><em>, </em><em>optional</em>) – wether to plot the final order fits (default: False)</p></li>
<li><p><strong>manual</strong> (<em>bool</em><em>, </em><em>optional</em>) – wether to manually select clusters to merge (strongly recommended) (default: True)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>orders</strong> – order tracing coefficients (in numpy order, i.e. largest exponent first)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array[nord, opower+1]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.trace_orders.merge_clusters">
<span class="sig-prename descclassname"><span class="pre">pyreduce.trace_orders.</span></span><span class="sig-name descname"><span class="pre">merge_clusters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_clusters</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">manual</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">auto_merge_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.9</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">merge_min_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/trace_orders.html#merge_clusters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.trace_orders.merge_clusters" title="Link to this definition">¶</a></dt>
<dd><p>Merge clusters that belong together</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<em>array</em><em>[</em><em>nrow</em><em>, </em><em>ncol</em><em>]</em>) – the image the order trace is based on</p></li>
<li><p><strong>orders</strong> (<em>dict</em><em>(</em><em>int</em><em>, </em><em>array</em><em>(</em><em>float</em><em>)</em><em>)</em>) – coefficients of polynomial fits to clusters</p></li>
<li><p><strong>x</strong> (<em>dict</em><em>(</em><em>int</em><em>, </em><em>array</em><em>(</em><em>int</em><em>)</em><em>)</em>) – x coordinates of cluster points</p></li>
<li><p><strong>y</strong> (<em>dict</em><em>(</em><em>int</em><em>, </em><em>array</em><em>(</em><em>int</em><em>)</em><em>)</em>) – y coordinates of cluster points</p></li>
<li><p><strong>n_clusters</strong> (<em>array</em><em>(</em><em>int</em><em>)</em>) – cluster numbers</p></li>
<li><p><strong>threshold</strong> (<em>int</em><em>, </em><em>optional</em>) – overlap threshold for merging clusters (the default is 100)</p></li>
<li><p><strong>manual</strong> (<em>bool</em><em>, </em><em>optional</em>) – if True ask before merging orders</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>x</strong> (<em>dict(int: array)</em>) – x coordinates of clusters, key=cluster id</p></li>
<li><p><strong>y</strong> (<em>dict(int: array)</em>) – y coordinates of clusters, key=cluster id</p></li>
<li><p><strong>n_clusters</strong> (<em>int</em>) – number of identified clusters</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.trace_orders.plot_order">
<span class="sig-prename descclassname"><span class="pre">pyreduce.trace_orders.</span></span><span class="sig-name descname"><span class="pre">plot_order</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">j</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/trace_orders.html#plot_order"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.trace_orders.plot_order" title="Link to this definition">¶</a></dt>
<dd><p>Plot a single order</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.trace_orders.plot_orders">
<span class="sig-prename descclassname"><span class="pre">pyreduce.trace_orders.</span></span><span class="sig-name descname"><span class="pre">plot_orders</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clusters</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order_range</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/trace_orders.html#plot_orders"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.trace_orders.plot_orders" title="Link to this definition">¶</a></dt>
<dd><p>Plot orders and image</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.trace_orders.update_merge_array">
<span class="sig-prename descclassname"><span class="pre">pyreduce.trace_orders.</span></span><span class="sig-name descname"><span class="pre">update_merge_array</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">merge</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">j</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_cluster_thickness</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nrow</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ncol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/trace_orders.html#update_merge_array"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.trace_orders.update_merge_array" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-pyreduce.util">
<span id="pyreduce-util-module"></span><h2>pyreduce.util module<a class="headerlink" href="#module-pyreduce.util" title="Link to this heading">¶</a></h2>
<p>Collection of various useful and/or reoccuring functions across PyReduce</p>
<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.air2vac">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">air2vac</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wl_air</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#air2vac"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.air2vac" title="Link to this definition">¶</a></dt>
<dd><p>Convert wavelengths in air to vacuum wavelength
Author: Nikolai Piskunov</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.bezier_interp">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">bezier_interp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x_old</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_old</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_new</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#bezier_interp"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.bezier_interp" title="Link to this definition">¶</a></dt>
<dd><p>Bezier interpolation, based on the scipy methods</p>
<p>This mostly sanitizes the input by removing masked values and duplicate entries
Note that in case of duplicate entries (in x_old) the results are not well defined as only one of the entries is used and the other is discarded</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x_old</strong> (<em>array</em><em>[</em><em>n</em><em>]</em>) – old x values</p></li>
<li><p><strong>y_old</strong> (<em>array</em><em>[</em><em>n</em><em>]</em>) – old y values</p></li>
<li><p><strong>x_new</strong> (<em>array</em><em>[</em><em>m</em><em>]</em>) – new x values</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>y_new</strong> – new y values</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array[m]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.bottom">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">bottom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">f</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">40</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">poly</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#bottom"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.bottom" title="Link to this definition">¶</a></dt>
<dd><p>bottom tries to fit a smooth curve to the lower envelope
of 1D data array f. Filter size “filter”
together with the total number of iterations determine
the smoothness and the quality of the fit. The total
number of iterations can be controlled by limiting the
maximum number of iterations (iter) and/or by setting
the convergence criterion for the fit (eps)
04-Nov-2000 N.Piskunov wrote.
09-Nov-2011 NP added weights and 2nd derivative constraint as LAM2</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>f</strong> (<em>Callable</em>) – Function to fit</p></li>
<li><p><strong>filter</strong> (<em>int</em>) – Smoothing parameter of the optimal filter (or polynomial degree of poly is True)</p></li>
<li><p><strong>iter</strong> (<em>int</em>) – maximum number of iterations [def: 40]</p></li>
<li><p><strong>eps</strong> (<em>float</em>) – convergence level [def: 0.001]</p></li>
<li><p><strong>mn</strong> (<em>float</em>) – minimum function values to be considered [def: min(f)]</p></li>
<li><p><strong>mx</strong> (<em>float</em>) – maximum function values to be considered [def: max(f)]</p></li>
<li><p><strong>lam2</strong> (<em>float</em>) – constraint on 2nd derivative</p></li>
<li><p><strong>weight</strong> (<em>array</em><em>(</em><em>float</em><em>)</em>) – vector of weights.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.cutout_image">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">cutout_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ymin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ymax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xmin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xmax</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#cutout_image"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.cutout_image" title="Link to this definition">¶</a></dt>
<dd><p>Cut a section of an image out</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<em>array</em>) – image</p></li>
<li><p><strong>ymin</strong> (<em>array</em><em>[</em><em>ncol</em><em>]</em><em>(</em><em>int</em><em>)</em>) – lower y value</p></li>
<li><p><strong>ymax</strong> (<em>array</em><em>[</em><em>ncol</em><em>]</em><em>(</em><em>int</em><em>)</em>) – upper y value</p></li>
<li><p><strong>xmin</strong> (<em>int</em>) – lower x value</p></li>
<li><p><strong>xmax</strong> (<em>int</em>) – upper x value</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>cutout</strong> – selection of the image</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array[height, ncol]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.find_first_index">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">find_first_index</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#find_first_index"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.find_first_index" title="Link to this definition">¶</a></dt>
<dd><p>find the first element equal to value in the array arr</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.gaussbroad">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">gaussbroad</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hwhm</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#gaussbroad"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.gaussbroad" title="Link to this definition">¶</a></dt>
<dd><p>Apply gaussian broadening to x, y data with half width half maximum hwhm</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array</em><em>(</em><em>float</em><em>)</em>) – x values</p></li>
<li><p><strong>y</strong> (<em>array</em><em>(</em><em>float</em><em>)</em>) – y values</p></li>
<li><p><strong>hwhm</strong> (<em>float &gt; 0</em>) – half width half maximum</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>broadened y values</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array(float)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.gaussfit">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">gaussfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#gaussfit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.gaussfit" title="Link to this definition">¶</a></dt>
<dd><p>Fit a simple gaussian to data</p>
<p>gauss(x, a, mu, sigma) = a * exp(-z**2/2)
with z = (x - mu) / sigma</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array</em><em>(</em><em>float</em><em>)</em>) – x values</p></li>
<li><p><strong>y</strong> (<em>array</em><em>(</em><em>float</em><em>)</em>) – y values</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>fitted values for x, fit paramters (a, mu, sigma)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>gauss(x), parameters</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.gaussfit2">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">gaussfit2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#gaussfit2"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.gaussfit2" title="Link to this definition">¶</a></dt>
<dd><p>Fit a gaussian(normal) curve to data x, y</p>
<p>gauss = A * exp(-(x-mu)**2/(2*sig**2)) + offset</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array</em><em>[</em><em>n</em><em>]</em>) – x values</p></li>
<li><p><strong>y</strong> (<em>array</em><em>[</em><em>n</em><em>]</em>) – y values</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>popt</strong> – coefficients of the gaussian: A, mu, sigma**2, offset</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array[4]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.gaussfit3">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">gaussfit3</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#gaussfit3"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.gaussfit3" title="Link to this definition">¶</a></dt>
<dd><p>A very simple (and relatively fast) gaussian fit
gauss = A * exp(-(x-mu)**2/(2*sig**2)) + offset</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>n</em><em>,</em><em>)</em>) – x data</p></li>
<li><p><strong>y</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>n</em><em>,</em><em>)</em>) – y data</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>popt</strong> – Parameters A, mu, sigma**2, offset</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list of shape (4,)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.gaussfit4">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">gaussfit4</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#gaussfit4"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.gaussfit4" title="Link to this definition">¶</a></dt>
<dd><p>A very simple (and relatively fast) gaussian fit
gauss = A * exp(-(x-mu)**2/(2*sig**2)) + offset</p>
<p>Assumes x is sorted</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>n</em><em>,</em><em>)</em>) – x data</p></li>
<li><p><strong>y</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>n</em><em>,</em><em>)</em>) – y data</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>popt</strong> – Parameters A, mu, sigma**2, offset</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list of shape (4,)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.gaussfit_linear">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">gaussfit_linear</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#gaussfit_linear"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.gaussfit_linear" title="Link to this definition">¶</a></dt>
<dd><p>Transform the gaussian fit into a linear least squares problem, and solve that instead of the non-linear curve fit
For efficiency reasons. (roughly 10 times faster than the curve fit)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>n</em><em>,</em><em>)</em>) – x data</p></li>
<li><p><strong>y</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>n</em><em>,</em><em>)</em>) – y data</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>coef</strong> – a, mu, sig, 0</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.gaussval2">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">gaussval2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sig</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">const</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#gaussval2"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.gaussval2" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.gridsearch">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">gridsearch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grid</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">args</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#gridsearch"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.gridsearch" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.helcorr">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">helcorr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs_long</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs_lat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs_alt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ra2000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dec2000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">system</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'barycentric'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#helcorr"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.helcorr" title="Link to this definition">¶</a></dt>
<dd><p>calculates heliocentric Julian date, barycentric and heliocentric radial
velocity corrections, using astropy functions</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs_long</strong> (<em>float</em>) – Longitude of observatory (degrees, western direction is positive)</p></li>
<li><p><strong>obs_lat</strong> (<em>float</em>) – Latitude of observatory (degrees)</p></li>
<li><p><strong>obs_alt</strong> (<em>float</em>) – Altitude of observatory (meters)</p></li>
<li><p><strong>ra2000</strong> (<em>float</em>) – Right ascension of object for epoch 2000.0 (hours)</p></li>
<li><p><strong>dec2000</strong> (<em>float</em>) – Declination of object for epoch 2000.0 (degrees)</p></li>
<li><p><strong>jd</strong> (<em>float</em>) – Julian date for the middle of exposure in MJD</p></li>
<li><p><strong>system</strong> (<em>{&quot;barycentric&quot;</em><em>, </em><em>&quot;heliocentric&quot;}</em><em>, </em><em>optional</em>) – reference system of the result, barycentric: around earth-sun gravity center,
heliocentric: around sun, usually barycentric is preferred (default: “barycentric)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>correction</strong> (<em>float</em>) – radial velocity correction due to barycentre offset</p></li>
<li><p><strong>hjd</strong> (<em>float</em>) – Heliocentric Julian date for middle of exposure</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.in_ipynb">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">in_ipynb</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#in_ipynb"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.in_ipynb" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.interpolate_masked">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">interpolate_masked</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">masked</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#interpolate_masked"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.interpolate_masked" title="Link to this definition">¶</a></dt>
<dd><p>Interpolate masked values, from non masked values</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>masked</strong> (<em>masked_array</em>) – masked array to interpolate on</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>interpolated</strong> – interpolated non masked array</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.log_version">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">log_version</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#log_version"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.log_version" title="Link to this definition">¶</a></dt>
<dd><p>For Debug purposes</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.make_index">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">make_index</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ymin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ymax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xmin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xmax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zero</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#make_index"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.make_index" title="Link to this definition">¶</a></dt>
<dd><p>Create an index (numpy style) that will select part of an image with changing position but fixed height</p>
<p>The user is responsible for making sure the height is constant, otherwise it will still work, but the subsection will not have the desired format</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ymin</strong> (<em>array</em><em>[</em><em>ncol</em><em>]</em><em>(</em><em>int</em><em>)</em>) – lower y border</p></li>
<li><p><strong>ymax</strong> (<em>array</em><em>[</em><em>ncol</em><em>]</em><em>(</em><em>int</em><em>)</em>) – upper y border</p></li>
<li><p><strong>xmin</strong> (<em>int</em>) – leftmost column</p></li>
<li><p><strong>xmax</strong> (<em>int</em>) – rightmost colum</p></li>
<li><p><strong>zero</strong> (<em>bool</em><em>, </em><em>optional</em>) – if True count y array from 0 instead of xmin (default: False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>index</strong> – numpy index for the selection of a subsection of an image</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple(array[height, width], array[height, width])</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.middle">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">middle</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">f</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">param</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">40</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">poly</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lambda2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#middle"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.middle" title="Link to this definition">¶</a></dt>
<dd><p>middle tries to fit a smooth curve that is located
along the “middle” of 1D data array f. Filter size “filter”
together with the total number of iterations determine
the smoothness and the quality of the fit. The total
number of iterations can be controlled by limiting the
maximum number of iterations (iter) and/or by setting
the convergence criterion for the fit (eps)
04-Nov-2000 N.Piskunov wrote.
09-Nov-2011 NP added weights and 2nd derivative constraint as LAM2</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>f</strong> (<em>Callable</em>) – Function to fit</p></li>
<li><p><strong>filter</strong> (<em>int</em>) – Smoothing parameter of the optimal filter (or polynomial degree of poly is True)</p></li>
<li><p><strong>iter</strong> (<em>int</em>) – maximum number of iterations [def: 40]</p></li>
<li><p><strong>eps</strong> (<em>float</em>) – convergence level [def: 0.001]</p></li>
<li><p><strong>mn</strong> (<em>float</em>) – minimum function values to be considered [def: min(f)]</p></li>
<li><p><strong>mx</strong> (<em>float</em>) – maximum function values to be considered [def: max(f)]</p></li>
<li><p><strong>lam2</strong> (<em>float</em>) – constraint on 2nd derivative</p></li>
<li><p><strong>weight</strong> (<em>array</em><em>(</em><em>float</em><em>)</em>) – vector of weights.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.opt_filter">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">opt_filter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">par</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">par1</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lambda2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxiter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#opt_filter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.opt_filter" title="Link to this definition">¶</a></dt>
<dd><p>Optimal filtering of 1D and 2D arrays.
Uses tridiag in 1D case and sprsin and linbcg in 2D case.
Written by N.Piskunov 8-May-2000</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>f</strong> (<em>array</em>) – 1d or 2d array</p></li>
<li><p><strong>xwidth</strong> (<em>int</em>) – filter width (for 2d array width in x direction (1st index)</p></li>
<li><p><strong>ywidth</strong> (<em>int</em>) – (for 2d array only) filter width in y direction (2nd index) if ywidth is missing for 2d array, it set equal to xwidth</p></li>
<li><p><strong>weight</strong> (<em>array</em><em>(</em><em>float</em><em>)</em>) – an array of the same size(s) as f containing values between 0 and 1</p></li>
<li><p><strong>lambda1</strong> (<em>float</em>) – regularization parameter</p></li>
<li><p><strong>maxiter</strong> (<em>int</em>) – maximum number of iteration for filtering of 2d array</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.plot2d">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">plot2d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coeff</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#plot2d"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.plot2d" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.polyfit1d">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">polyfit1d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regularization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#polyfit1d"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.polyfit1d" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.polyfit2d">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">polyfit2d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_degree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#polyfit2d"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.polyfit2d" title="Link to this definition">¶</a></dt>
<dd><p>A simple 2D plynomial fit to data x, y, z
The polynomial can be evaluated with numpy.polynomial.polynomial.polyval2d</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array</em><em>[</em><em>n</em><em>]</em>) – x coordinates</p></li>
<li><p><strong>y</strong> (<em>array</em><em>[</em><em>n</em><em>]</em>) – y coordinates</p></li>
<li><p><strong>z</strong> (<em>array</em><em>[</em><em>n</em><em>]</em>) – data values</p></li>
<li><p><strong>degree</strong> (<em>int</em><em>, </em><em>optional</em>) – degree of the polynomial fit (default: 1)</p></li>
<li><p><strong>max_degree</strong> (<em>{int</em><em>, </em><em>None}</em><em>, </em><em>optional</em>) – if given the maximum combined degree of the coefficients is limited to this value</p></li>
<li><p><strong>scale</strong> (<em>bool</em><em>, </em><em>optional</em>) – Wether to scale the input arrays x and y to mean 0 and variance 1, to avoid numerical overflows.
Especially useful at higher degrees. (default: True)</p></li>
<li><p><strong>plot</strong> (<em>bool</em><em>, </em><em>optional</em>) – wether to plot the fitted surface and data (slow) (default: False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>coeff</strong> – the polynomial coefficients in numpy 2d format, i.e. coeff[i, j] for x**i * y**j</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array[degree+1, degree+1]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.polyfit2d_2">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">polyfit2d_2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x0</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'arctan'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'trf'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#polyfit2d_2"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.polyfit2d_2" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.polyscale2d">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">polyscale2d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">coeff</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale_x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale_y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#polyscale2d"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.polyscale2d" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.polyshift2d">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">polyshift2d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">coeff</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">offset_x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">offset_y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#polyshift2d"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.polyshift2d" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.polyvander2d">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">polyvander2d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degree</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#polyvander2d"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.polyvander2d" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.remove_bias">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">remove_bias</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ihead</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bhead</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nfiles</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#remove_bias"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.remove_bias" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.resample">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">resample</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_size</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#resample"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.resample" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.safe_interpolation">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">safe_interpolation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x_old</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_old</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_new</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fill_value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#safe_interpolation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.safe_interpolation" title="Link to this definition">¶</a></dt>
<dd><p>‘Safe’ interpolation method that should avoid
the common pitfalls of spline interpolation</p>
<p>masked arrays are compressed, i.e. only non masked entries are used
remove NaN input in x_old and y_old
only unique x values are used, corresponding y values are ‘random’
if all else fails, revert to linear interpolation</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x_old</strong> (<em>array</em><em> of </em><em>size</em><em> (</em><em>n</em><em>,</em><em>)</em>) – x values of the data</p></li>
<li><p><strong>y_old</strong> (<em>array</em><em> of </em><em>size</em><em> (</em><em>n</em><em>,</em><em>)</em>) – y values of the data</p></li>
<li><p><strong>x_new</strong> (<em>array</em><em> of </em><em>size</em><em> (</em><em>m</em><em>, </em><em>) or </em><em>None</em><em>, </em><em>optional</em>) – x values of the interpolated values
if None will return the interpolator object
(default: None)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>y_new</strong> – if x_new was given, return the interpolated values
otherwise return the interpolator object</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array of size (m, ) or interpolator</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.start_logging">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">start_logging</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">log_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'log.log'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#start_logging"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.start_logging" title="Link to this definition">¶</a></dt>
<dd><p>Start logging to log file and command line</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>log_file</strong> (<em>str</em><em>, </em><em>optional</em>) – name of the logging file (default: “log.log”)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.swap_extension">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">swap_extension</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ext</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#swap_extension"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.swap_extension" title="Link to this definition">¶</a></dt>
<dd><p>exchange the extension of the given file with a new one</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.top">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">top</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">f</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">40</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">poly</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lambda2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#top"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.top" title="Link to this definition">¶</a></dt>
<dd><p>top tries to fit a smooth curve to the upper envelope
of 1D data array f. Filter size “filter”
together with the total number of iterations determine
the smoothness and the quality of the fit. The total
number of iterations can be controlled by limiting the
maximum number of iterations (iter) and/or by setting
the convergence criterion for the fit (eps)
04-Nov-2000 N.Piskunov wrote.
09-Nov-2011 NP added weights and 2nd derivative constraint as LAM2</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>f</strong> (<em>Callable</em>) – Function to fit</p></li>
<li><p><strong>filter</strong> (<em>int</em>) – Smoothing parameter of the optimal filter (or polynomial degree of poly is True)</p></li>
<li><p><strong>iter</strong> (<em>int</em>) – maximum number of iterations [def: 40]</p></li>
<li><p><strong>eps</strong> (<em>float</em>) – convergence level [def: 0.001]</p></li>
<li><p><strong>mn</strong> (<em>float</em>) – minimum function values to be considered [def: min(f)]</p></li>
<li><p><strong>mx</strong> (<em>float</em>) – maximum function values to be considered [def: max(f)]</p></li>
<li><p><strong>lam2</strong> (<em>float</em>) – constraint on 2nd derivative</p></li>
<li><p><strong>weight</strong> (<em>array</em><em>(</em><em>float</em><em>)</em>) – vector of weights.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.util.vac2air">
<span class="sig-prename descclassname"><span class="pre">pyreduce.util.</span></span><span class="sig-name descname"><span class="pre">vac2air</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wl_vac</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/util.html#vac2air"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.util.vac2air" title="Link to this definition">¶</a></dt>
<dd><p>Convert vacuum wavelengths to wavelengths in air
Author: Nikolai Piskunov</p>
</dd></dl>

</section>
<section id="module-pyreduce.wavelength_calibration">
<span id="pyreduce-wavelength-calibration-module"></span><h2>pyreduce.wavelength_calibration module<a class="headerlink" href="#module-pyreduce.wavelength_calibration" title="Link to this heading">¶</a></h2>
<p>Wavelength Calibration
by comparison to a reference spectrum
Loosely bases on the IDL wavecal function</p>
<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.AlignmentPlot">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.wavelength_calibration.</span></span><span class="sig-name descname"><span class="pre">AlignmentPlot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lines</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">offset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#AlignmentPlot"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.AlignmentPlot" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Makes a plot which can be clicked to align the two spectra, reference and observed</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.AlignmentPlot.connect">
<span class="sig-name descname"><span class="pre">connect</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#AlignmentPlot.connect"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.AlignmentPlot.connect" title="Link to this definition">¶</a></dt>
<dd><p>connect the click event with the appropiate function</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.AlignmentPlot.make_ref_image">
<span class="sig-name descname"><span class="pre">make_ref_image</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#AlignmentPlot.make_ref_image"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.AlignmentPlot.make_ref_image" title="Link to this definition">¶</a></dt>
<dd><p>create and show the reference plot, with the two spectra</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.AlignmentPlot.on_click">
<span class="sig-name descname"><span class="pre">on_click</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#AlignmentPlot.on_click"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.AlignmentPlot.on_click" title="Link to this definition">¶</a></dt>
<dd><p>On click offset the reference by the distance between click positions</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.LineAtlas">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.wavelength_calibration.</span></span><span class="sig-name descname"><span class="pre">LineAtlas</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">element</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">medium</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'vac'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#LineAtlas"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.LineAtlas" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.LineAtlas.load_fits">
<span class="sig-name descname"><span class="pre">load_fits</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fname</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#LineAtlas.load_fits"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.LineAtlas.load_fits" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.LineList">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.wavelength_calibration.</span></span><span class="sig-name descname"><span class="pre">LineList</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lines</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#LineList"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.LineList" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.LineList.add_line">
<span class="sig-name descname"><span class="pre">add_line</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wave</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pos</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">width</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">height</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flag</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#LineList.add_line"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.LineList.add_line" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.LineList.append">
<span class="sig-name descname"><span class="pre">append</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">linelist</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#LineList.append"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.LineList.append" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.LineList.dtype">
<span class="sig-name descname"><span class="pre">dtype</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">dtype((numpy.record,</span> <span class="pre">[(('wlc',</span> <span class="pre">'WLC'),</span> <span class="pre">'&gt;f8'),</span> <span class="pre">(('wll',</span> <span class="pre">'WLL'),</span> <span class="pre">'&gt;f8'),</span> <span class="pre">(('posc',</span> <span class="pre">'POSC'),</span> <span class="pre">'&gt;f8'),</span> <span class="pre">(('posm',</span> <span class="pre">'POSM'),</span> <span class="pre">'&gt;f8'),</span> <span class="pre">(('xfirst',</span> <span class="pre">'XFIRST'),</span> <span class="pre">'&gt;i2'),</span> <span class="pre">(('xlast',</span> <span class="pre">'XLAST'),</span> <span class="pre">'&gt;i2'),</span> <span class="pre">(('approx',</span> <span class="pre">'APPROX'),</span> <span class="pre">'O'),</span> <span class="pre">(('width',</span> <span class="pre">'WIDTH'),</span> <span class="pre">'&gt;f8'),</span> <span class="pre">(('height',</span> <span class="pre">'HEIGHT'),</span> <span class="pre">'&gt;f8'),</span> <span class="pre">(('order',</span> <span class="pre">'ORDER'),</span> <span class="pre">'&gt;i2'),</span> <span class="pre">('flag',</span> <span class="pre">'?')]))</span></em><a class="headerlink" href="#pyreduce.wavelength_calibration.LineList.dtype" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.LineList.from_list">
<em class="property"><span class="k"><span class="pre">classmethod</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wave</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pos</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">width</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">height</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flag</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#LineList.from_list"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.LineList.from_list" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.LineList.load">
<em class="property"><span class="k"><span class="pre">classmethod</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#LineList.load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.LineList.load" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.LineList.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#LineList.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.LineList.save" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.wavelength_calibration.</span></span><span class="sig-name descname"><span class="pre">WavelengthCalibration</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(6,</span> <span class="pre">6)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dimensionality</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'2D'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nstep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">correlate_cols</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift_window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">manual</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">polarim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lfc_peak_width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">closing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">element</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">medium</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'vac'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibration"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Wavelength Calibration Module</p>
<p>Takes an observed wavelength image and the reference linelist
and returns the wavelength at each pixel</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.align">
<span class="sig-name descname"><span class="pre">align</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lines</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibration.align"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.align" title="Link to this definition">¶</a></dt>
<dd><p>Align the observation with the reference spectrum
Either automatically using cross correlation or manually (visually)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> (<em>array</em><em>[</em><em>nrow</em><em>, </em><em>ncol</em><em>]</em>) – observed wavelength calibration spectrum (e.g. obs=ThoriumArgon)</p></li>
<li><p><strong>lines</strong> (<em>struct_array</em>) – reference line data</p></li>
<li><p><strong>manual</strong> (<em>bool</em><em>, </em><em>optional</em>) – wether to manually align the spectra (default: False)</p></li>
<li><p><strong>plot</strong> (<em>bool</em><em>, </em><em>optional</em>) – wether to plot the alignment (default: False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>offset</strong> – offset in order and column</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple(int, int)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.align_manual">
<span class="sig-name descname"><span class="pre">align_manual</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lines</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibration.align_manual"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.align_manual" title="Link to this definition">¶</a></dt>
<dd><p>Open an AlignmentPlot window for manual selection of the alignment</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em>) – observed image</p></li>
<li><p><strong>lines</strong> (<em>recarray</em><em> of </em><em>shape</em><em> (</em><em>nlines</em><em>,</em><em>)</em>) – reference linelist</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>offset</strong> – offset in order and column to be applied to each line in the linelist</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple(int, int)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.apply_alignment_offset">
<span class="sig-name descname"><span class="pre">apply_alignment_offset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lines</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">offset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">select</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibration.apply_alignment_offset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.apply_alignment_offset" title="Link to this definition">¶</a></dt>
<dd><p>Apply an offset to the linelist</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lines</strong> (<em>recarray</em><em> of </em><em>shape</em><em> (</em><em>nlines</em><em>,</em><em>)</em>) – reference linelist</p></li>
<li><p><strong>offset</strong> (<em>tuple</em><em>(</em><em>int</em><em>, </em><em>int</em><em>)</em>) – offset in (order, column)</p></li>
<li><p><strong>select</strong> (<em>array</em><em> of </em><em>shape</em><em>(</em><em>nlines</em><em>,</em><em>)</em><em>, </em><em>optional</em>) – Mask that defines which lines the offset applies to</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>lines</strong> – linelist with offset applied</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>recarray of shape (nlines,)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.auto_id">
<span class="sig-name descname"><span class="pre">auto_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wave_img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lines</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibration.auto_id"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.auto_id" title="Link to this definition">¶</a></dt>
<dd><p>Automatically identify peaks that are close to known lines</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em>) – observed spectrum</p></li>
<li><p><strong>wave_img</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em>) – wavelength solution image</p></li>
<li><p><strong>lines</strong> (<em>struc_array</em>) – line data</p></li>
<li><p><strong>threshold</strong> (<em>int</em><em>, </em><em>optional</em>) – difference threshold between line positions in m/s, until which a line is considered identified (default: 1)</p></li>
<li><p><strong>plot</strong> (<em>bool</em><em>, </em><em>optional</em>) – wether to plot the new lines</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>lines</strong> – line data with new flags</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>struct_array</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.build_2d_solution">
<span class="sig-name descname"><span class="pre">build_2d_solution</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lines</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibration.build_2d_solution"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.build_2d_solution" title="Link to this definition">¶</a></dt>
<dd><p>Create a 2D polynomial fit to flagged lines
degree : tuple(int, int), optional</p>
<blockquote>
<div><p>polynomial degree of the fit in (column, order) dimension (default: (6, 6))</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lines</strong> (<em>struc_array</em>) – line data</p></li>
<li><p><strong>plot</strong> (<em>bool</em><em>, </em><em>optional</em>) – wether to plot the solution (default: False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>coef</strong> – 2d polynomial coefficients</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array[degree_x, degree_y]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.build_step_solution">
<span class="sig-name descname"><span class="pre">build_step_solution</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lines</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibration.build_step_solution"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.build_step_solution" title="Link to this definition">¶</a></dt>
<dd><p>Fit the least squares fit to the wavelength points,
with additional free parameters for detector gaps, e.g. due to stitching.</p>
<p>The exact method of the fit depends on the dimensionality.
Either way we are using the usual polynomial fit for the wavelength, but
the x points are modified beforehand by shifting them some amount, at specific
indices. We assume that the stitching effects are distributed evenly and we know how
many steps we expect (this is set as “nstep”).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lines</strong> (<em>np.recarray</em>) – linedata</p></li>
<li><p><strong>plot</strong> (<em>bool</em><em>, </em><em>optional</em>) – whether to plot results or not, by default False</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>coefficients of the best fit</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>coef</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.calculate_AIC">
<span class="sig-name descname"><span class="pre">calculate_AIC</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lines</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wave_solution</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibration.calculate_AIC"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.calculate_AIC" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.calculate_residual">
<span class="sig-name descname"><span class="pre">calculate_residual</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wave_solution</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lines</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibration.calculate_residual"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.calculate_residual" title="Link to this definition">¶</a></dt>
<dd><p>Calculate all residuals of all given lines</p>
<p>Residual = (Wavelength Solution - Expected Wavelength) / Expected Wavelength * speed of light</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wave_solution</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>degree_x</em><em>, </em><em>degree_y</em><em>)</em>) – polynomial coefficients of the wavelength solution (in numpy format)</p></li>
<li><p><strong>lines</strong> (<em>recarray</em><em> of </em><em>shape</em><em> (</em><em>nlines</em><em>,</em><em>)</em>) – contains the position of the line on the detector (posm), the order (order), and the expected wavelength (wll)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>residual</strong> – Residual of each line in m/s</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array of shape (nlines,)</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.closing">
<span class="sig-name descname"><span class="pre">closing</span></span><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.closing" title="Link to this definition">¶</a></dt>
<dd><p>grey closing range for the input image</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.correlate_cols">
<span class="sig-name descname"><span class="pre">correlate_cols</span></span><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.correlate_cols" title="Link to this definition">¶</a></dt>
<dd><p>How many columns to use in the 2D cross correlation alignment. 0 means all pixels (slow).</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.create_image_from_lines">
<span class="sig-name descname"><span class="pre">create_image_from_lines</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lines</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibration.create_image_from_lines"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.create_image_from_lines" title="Link to this definition">¶</a></dt>
<dd><p>Create a reference image based on a line list
Each line will be approximated by a Gaussian
Space inbetween lines is 0
The number of orders is from 0 to the maximum order</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>lines</strong> (<em>recarray</em><em> of </em><em>shape</em><em> (</em><em>nlines</em><em>,</em><em>)</em>) – line data</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>img</strong> – New reference image</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array of shape (nord, ncol)</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.degree">
<span class="sig-name descname"><span class="pre">degree</span></span><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.degree" title="Link to this definition">¶</a></dt>
<dd><p>polynomial degree of the wavelength fit in (pixel, order) direction</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple(int, int)</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.dimensionality">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">dimensionality</span></span><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.dimensionality" title="Link to this definition">¶</a></dt>
<dd><p>Whether to use 1d or 2d fit</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>{“1D”, “2D”}</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.element">
<span class="sig-name descname"><span class="pre">element</span></span><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.element" title="Link to this definition">¶</a></dt>
<dd><p>Elements used in the wavelength calibration. Used in AutoId to find more lines from the Atlas</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.evaluate_solution">
<span class="sig-name descname"><span class="pre">evaluate_solution</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pos</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">solution</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibration.evaluate_solution"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.evaluate_solution" title="Link to this definition">¶</a></dt>
<dd><p>Evaluate the 1d or 2d wavelength solution at the given pixel positions and orders</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pos</strong> (<em>array</em>) – pixel position on the detector (i.e. x axis)</p></li>
<li><p><strong>order</strong> (<em>array</em>) – order of each point</p></li>
<li><p><strong>solution</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ndegree</em><em>) or </em><em>(</em><em>degree_x</em><em>, </em><em>degree_y</em><em>)</em>) – polynomial coefficients. For mode=1D, one set of coefficients per order.
For mode=2D, the first dimension is for the positions and the second for the orders</p></li>
<li><p><strong>mode</strong> (<em>str</em><em>, </em><em>optional</em>) – Wether to interpret the solution as 1D or 2D polynomials, by default “1D”</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>result</strong> – Evaluated polynomial</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If pos and order have different shapes, or mode is of the wrong value</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.evaluate_step_solution">
<span class="sig-name descname"><span class="pre">evaluate_step_solution</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pos</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">solution</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibration.evaluate_step_solution"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.evaluate_step_solution" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.execute">
<span class="sig-name descname"><span class="pre">execute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lines</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibration.execute"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.execute" title="Link to this definition">¶</a></dt>
<dd><p>Perform the whole wavelength calibration procedure with the current settings</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em>) – observed image</p></li>
<li><p><strong>lines</strong> (<em>recarray</em><em> of </em><em>shape</em><em> (</em><em>nlines</em><em>,</em><em>)</em>) – reference linelist</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>wave_img</strong> – Wavelength solution for each pixel</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array of shape (nord, ncol)</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>NotImplementedError</strong> – If polarimitry flag is set</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.f">
<span class="sig-name descname"><span class="pre">f</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">poly_coef</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_coef_pos</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_coef_diff</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibration.f"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.f" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.fit_lines">
<span class="sig-name descname"><span class="pre">fit_lines</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lines</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibration.fit_lines"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.fit_lines" title="Link to this definition">¶</a></dt>
<dd><p>Determine exact position of each line on the detector based on initial guess</p>
<p>This fits a Gaussian to each line, and uses the peak position as a new solution</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em>) – observed wavelength calibration image</p></li>
<li><p><strong>lines</strong> (<em>recarray</em><em> of </em><em>shape</em><em> (</em><em>nlines</em><em>,</em><em>)</em>) – reference line data</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>lines</strong> – Updated line information (posm is changed)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>recarray of shape (nlines,)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.g">
<span class="sig-name descname"><span class="pre">g</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_coef_pos</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_coef_diff</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibration.g"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.g" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.iterations">
<span class="sig-name descname"><span class="pre">iterations</span></span><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.iterations" title="Link to this definition">¶</a></dt>
<dd><p>Number of iterations in the remove residuals, auto id, loop</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.lfc_peak_width">
<span class="sig-name descname"><span class="pre">lfc_peak_width</span></span><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.lfc_peak_width" title="Link to this definition">¶</a></dt>
<dd><p>Laser Frequency Peak width (for scipy.signal.find_peaks)</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.make_wave">
<span class="sig-name descname"><span class="pre">make_wave</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wave_solution</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibration.make_wave"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.make_wave" title="Link to this definition">¶</a></dt>
<dd><p>Expand polynomial wavelength solution into full image</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wave_solution</strong> (<em>array</em><em> of </em><em>shape</em><em>(</em><em>degree</em><em>,</em><em>)</em>) – polynomial coefficients of wavelength solution</p></li>
<li><p><strong>plot</strong> (<em>bool</em><em>, </em><em>optional</em>) – wether to plot the solution (default: False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>wave_img</strong> – wavelength solution for each point in the spectrum</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array of shape (nord, ncol)</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.manual">
<span class="sig-name descname"><span class="pre">manual</span></span><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.manual" title="Link to this definition">¶</a></dt>
<dd><p>Whether to manually align the reference instead of using cross correlation</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.medium">
<span class="sig-name descname"><span class="pre">medium</span></span><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.medium" title="Link to this definition">¶</a></dt>
<dd><p>Medium of the detector, vac or air</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.ncol">
<span class="sig-name descname"><span class="pre">ncol</span></span><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.ncol" title="Link to this definition">¶</a></dt>
<dd><p>Number of columns in the observation</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.nord">
<span class="sig-name descname"><span class="pre">nord</span></span><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.nord" title="Link to this definition">¶</a></dt>
<dd><p>Number of orders in the observation</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.normalize">
<span class="sig-name descname"><span class="pre">normalize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lines</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibration.normalize"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.normalize" title="Link to this definition">¶</a></dt>
<dd><p>Normalize the observation and reference list in each order individually
Copies the data if the image, but not of the linelist</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em>) – observed image</p></li>
<li><p><strong>lines</strong> (<em>recarray</em><em> of </em><em>shape</em><em> (</em><em>nlines</em><em>,</em><em>)</em>) – reference linelist</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>obs</strong> (<em>array of shape (nord, ncol)</em>) – normalized image</p></li>
<li><p><strong>lines</strong> (<em>recarray of shape (nlines,)</em>) – normalized reference linelist</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.nstep">
<span class="sig-name descname"><span class="pre">nstep</span></span><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.nstep" title="Link to this definition">¶</a></dt>
<dd><p>Whether to fit for pixel steps (offsets) in the detector</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.plot">
<span class="sig-name descname"><span class="pre">plot</span></span><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.plot" title="Link to this definition">¶</a></dt>
<dd><p>Whether to plot the results. Set to 2 to plot during all steps.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.plot_residuals">
<span class="sig-name descname"><span class="pre">plot_residuals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lines</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coef</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Residuals'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibration.plot_residuals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.plot_residuals" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.plot_results">
<span class="sig-name descname"><span class="pre">plot_results</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wave_img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibration.plot_results"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.plot_results" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.polarim">
<span class="sig-name descname"><span class="pre">polarim</span></span><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.polarim" title="Link to this definition">¶</a></dt>
<dd><p>Whether to use polarimetric orders instead of the usual ones. I.e. Each pair of two orders represents the same data. Not Supported yet</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.reject_lines">
<span class="sig-name descname"><span class="pre">reject_lines</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lines</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibration.reject_lines"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.reject_lines" title="Link to this definition">¶</a></dt>
<dd><p>Reject the largest outlier one by one until all residuals are lower than the threshold</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lines</strong> (<em>recarray</em><em> of </em><em>shape</em><em> (</em><em>nlines</em><em>,</em><em>)</em>) – Line data with pixel position, and expected wavelength</p></li>
<li><p><strong>threshold</strong> (<em>float</em><em>, </em><em>optional</em>) – upper limit for the residual, by default 100</p></li>
<li><p><strong>degree</strong> (<em>tuple</em><em>, </em><em>optional</em>) – polynomial degree of the wavelength solution (pixel, column) (default: (6, 6))</p></li>
<li><p><strong>plot</strong> (<em>bool</em><em>, </em><em>optional</em>) – Wether to plot the results (default: False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>lines</strong> – Line data with updated flags</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>recarray of shape (nlines,)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.reject_outlier">
<span class="sig-name descname"><span class="pre">reject_outlier</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">residual</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lines</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibration.reject_outlier"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.reject_outlier" title="Link to this definition">¶</a></dt>
<dd><p>Reject the strongest outlier</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>residual</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nlines</em><em>,</em><em>)</em>) – residuals of all lines</p></li>
<li><p><strong>lines</strong> (<em>recarray</em><em> of </em><em>shape</em><em> (</em><em>nlines</em><em>,</em><em>)</em>) – line data</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>lines</strong> (<em>struct_array</em>) – line data with one more flagged line</p></li>
<li><p><strong>residual</strong> (<em>array of shape (nlines,)</em>) – residuals of each line, with outliers masked (including the new one)</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.shift_window">
<span class="sig-name descname"><span class="pre">shift_window</span></span><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.shift_window" title="Link to this definition">¶</a></dt>
<dd><p>Fraction if the number of columns to use in the alignment of individual orders. Set to 0 to disable</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.step_mode">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">step_mode</span></span><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.step_mode" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibration.threshold">
<span class="sig-name descname"><span class="pre">threshold</span></span><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibration.threshold" title="Link to this definition">¶</a></dt>
<dd><p>Residual threshold in m/s above which to remove lines</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibrationComb">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.wavelength_calibration.</span></span><span class="sig-name descname"><span class="pre">WavelengthCalibrationComb</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(6,</span> <span class="pre">6)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dimensionality</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'2D'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nstep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">correlate_cols</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift_window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">manual</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">polarim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lfc_peak_width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">closing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">element</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">medium</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'vac'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibrationComb"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibrationComb" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyreduce.wavelength_calibration.WavelengthCalibration" title="pyreduce.wavelength_calibration.WavelengthCalibration"><code class="xref py py-class docutils literal notranslate"><span class="pre">WavelengthCalibration</span></code></a></p>
<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibrationComb.execute">
<span class="sig-name descname"><span class="pre">execute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">comb</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wave</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lines</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibrationComb.execute"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibrationComb.execute" title="Link to this definition">¶</a></dt>
<dd><p>Perform the whole wavelength calibration procedure with the current settings</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em>) – observed image</p></li>
<li><p><strong>lines</strong> (<em>recarray</em><em> of </em><em>shape</em><em> (</em><em>nlines</em><em>,</em><em>)</em>) – reference linelist</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>wave_img</strong> – Wavelength solution for each pixel</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array of shape (nord, ncol)</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>NotImplementedError</strong> – If polarimitry flag is set</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibrationInitialize">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.wavelength_calibration.</span></span><span class="sig-name descname"><span class="pre">WavelengthCalibrationInitialize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">degree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Wavecal</span> <span class="pre">Initial'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wave_delta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nwalkers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">steps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resid_delta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cutoff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smoothing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">element</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'thar'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">medium</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'vac'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibrationInitialize"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibrationInitialize" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyreduce.wavelength_calibration.WavelengthCalibration" title="pyreduce.wavelength_calibration.WavelengthCalibration"><code class="xref py py-class docutils literal notranslate"><span class="pre">WavelengthCalibration</span></code></a></p>
<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibrationInitialize.create_new_linelist_from_solution">
<span class="sig-name descname"><span class="pre">create_new_linelist_from_solution</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spectrum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wavelength</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atlas</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#pyreduce.wavelength_calibration.LineList" title="pyreduce.wavelength_calibration.LineList"><span class="pre">LineList</span></a></span></span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibrationInitialize.create_new_linelist_from_solution"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibrationInitialize.create_new_linelist_from_solution" title="Link to this definition">¶</a></dt>
<dd><p>Create a new linelist based on an existing wavelength solution for a spectrum,
and a line atlas with known lines. The linelist is the one used by the rest of
PyReduce wavelength calibration.</p>
<p>Observed lines are matched with the lines in the atlas to
improve the wavelength solution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>spectrum</strong> (<em>array</em>) – Observed spectrum at each pixel</p></li>
<li><p><strong>wavelength</strong> (<em>array</em>) – Wavelength of spectrum at each pixel</p></li>
<li><p><strong>atlas</strong> (<a class="reference internal" href="#pyreduce.wavelength_calibration.LineAtlas" title="pyreduce.wavelength_calibration.LineAtlas"><em>LineAtlas</em></a>) – Atlas with wavelength of known lines</p></li>
<li><p><strong>order</strong> (<em>int</em>) – Order of the spectrum within the detector</p></li>
<li><p><strong>resid_delta</strong> (<em>float</em><em>, </em><em>optional</em>) – Maximum residual allowed between a peak and the closest line in the atlas,
to still match them, in m/s, by default 1000.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>linelist</strong> – new linelist with lines from this order</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#pyreduce.wavelength_calibration.LineList" title="pyreduce.wavelength_calibration.LineList">LineList</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibrationInitialize.cutoff">
<span class="sig-name descname"><span class="pre">cutoff</span></span><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibrationInitialize.cutoff" title="Link to this definition">¶</a></dt>
<dd><p>minimum value in the spectrum to be considered a spectral line, if the value is above (or equal 1) it defines the percentile of the spectrum</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibrationInitialize.determine_wavelength_coefficients">
<span class="sig-name descname"><span class="pre">determine_wavelength_coefficients</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spectrum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atlas</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wave_range</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ndarray</span></span></span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibrationInitialize.determine_wavelength_coefficients"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibrationInitialize.determine_wavelength_coefficients" title="Link to this definition">¶</a></dt>
<dd><p>Determines the wavelength polynomial coefficients of a spectrum,
based on an line atlas with known spectral lines,
and an initial guess for the wavelength range.
The calculation uses an MCMC approach to sample the probability space and
find the best cross correlation value, between observation and atlas.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>spectrum</strong> (<em>array</em>) – observed spectrum at each pixel</p></li>
<li><p><strong>atlas</strong> (<a class="reference internal" href="#pyreduce.wavelength_calibration.LineAtlas" title="pyreduce.wavelength_calibration.LineAtlas"><em>LineAtlas</em></a>) – atlas containing a known spectrum with wavelength and flux</p></li>
<li><p><strong>wave_range</strong> (<em>2-tuple</em>) – initial wavelength guess (begin, end)</p></li>
<li><p><strong>degrees</strong> (<em>int</em><em>, </em><em>optional</em>) – number of degrees of the wavelength polynomial,
lower numbers yield better results, by default 2</p></li>
<li><p><strong>w_range</strong> (<em>float</em><em>, </em><em>optional</em>) – uncertainty on the initial wavelength guess in Ansgtrom, by default 20</p></li>
<li><p><strong>nwalkers</strong> (<em>int</em><em>, </em><em>optional</em>) – number of walkers for the MCMC, more is better but increases
the time, by default 100</p></li>
<li><p><strong>steps</strong> (<em>int</em><em>, </em><em>optional</em>) – number of steps in the MCMC per walker, more is better but increases
the time, by default 20_000</p></li>
<li><p><strong>plot</strong> (<em>bool</em><em>, </em><em>optional</em>) – whether to plot the results or not, by default False</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>coef</strong> – polynomial coefficients in numpy order</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibrationInitialize.execute">
<span class="sig-name descname"><span class="pre">execute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spectrum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wave_range</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#pyreduce.wavelength_calibration.LineList" title="pyreduce.wavelength_calibration.LineList"><span class="pre">LineList</span></a></span></span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibrationInitialize.execute"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibrationInitialize.execute" title="Link to this definition">¶</a></dt>
<dd><p>Perform the whole wavelength calibration procedure with the current settings</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em>) – observed image</p></li>
<li><p><strong>lines</strong> (<em>recarray</em><em> of </em><em>shape</em><em> (</em><em>nlines</em><em>,</em><em>)</em>) – reference linelist</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>wave_img</strong> – Wavelength solution for each pixel</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array of shape (nord, ncol)</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>NotImplementedError</strong> – If polarimitry flag is set</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibrationInitialize.get_cutoff">
<span class="sig-name descname"><span class="pre">get_cutoff</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spectrum</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibrationInitialize.get_cutoff"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibrationInitialize.get_cutoff" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibrationInitialize.normalize">
<span class="sig-name descname"><span class="pre">normalize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spectrum</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#WavelengthCalibrationInitialize.normalize"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibrationInitialize.normalize" title="Link to this definition">¶</a></dt>
<dd><p>Normalize the observation and reference list in each order individually
Copies the data if the image, but not of the linelist</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nord</em><em>, </em><em>ncol</em><em>)</em>) – observed image</p></li>
<li><p><strong>lines</strong> (<em>recarray</em><em> of </em><em>shape</em><em> (</em><em>nlines</em><em>,</em><em>)</em>) – reference linelist</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>obs</strong> (<em>array of shape (nord, ncol)</em>) – normalized image</p></li>
<li><p><strong>lines</strong> (<em>recarray of shape (nlines,)</em>) – normalized reference linelist</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibrationInitialize.nwalkers">
<span class="sig-name descname"><span class="pre">nwalkers</span></span><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibrationInitialize.nwalkers" title="Link to this definition">¶</a></dt>
<dd><p>number of walkers in the MCMC</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibrationInitialize.resid_delta">
<span class="sig-name descname"><span class="pre">resid_delta</span></span><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibrationInitialize.resid_delta" title="Link to this definition">¶</a></dt>
<dd><p>residual uncertainty allowed when matching observation with known lines</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibrationInitialize.smoothing">
<span class="sig-name descname"><span class="pre">smoothing</span></span><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibrationInitialize.smoothing" title="Link to this definition">¶</a></dt>
<dd><p>gaussian smoothing applied to the wavecal spectrum before the MCMC in pixel scale, disable it by setting it to 0</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibrationInitialize.steps">
<span class="sig-name descname"><span class="pre">steps</span></span><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibrationInitialize.steps" title="Link to this definition">¶</a></dt>
<dd><p>number of steps in the MCMC</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.WavelengthCalibrationInitialize.wave_delta">
<span class="sig-name descname"><span class="pre">wave_delta</span></span><a class="headerlink" href="#pyreduce.wavelength_calibration.WavelengthCalibrationInitialize.wave_delta" title="Link to this definition">¶</a></dt>
<dd><p>wavelength uncertainty on the initial guess in Angstrom</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyreduce.wavelength_calibration.polyfit">
<span class="sig-prename descclassname"><span class="pre">pyreduce.wavelength_calibration.</span></span><span class="sig-name descname"><span class="pre">polyfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deg</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce/wavelength_calibration.html#polyfit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.wavelength_calibration.polyfit" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-pyreduce">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-pyreduce" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="pyreduce.TqdmLoggingHandler">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyreduce.</span></span><span class="sig-name descname"><span class="pre">TqdmLoggingHandler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce.html#TqdmLoggingHandler"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.TqdmLoggingHandler" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Handler</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="pyreduce.TqdmLoggingHandler.emit">
<span class="sig-name descname"><span class="pre">emit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">record</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyreduce.html#TqdmLoggingHandler.emit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyreduce.TqdmLoggingHandler.emit" title="Link to this definition">¶</a></dt>
<dd><p>Do whatever it takes to actually log the specified logging record.</p>
<p>This version is intended to be implemented by subclasses and so
raises a NotImplementedError.</p>
</dd></dl>

</dd></dl>

</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">PyReduce</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="howto.html">How To use PyReduce</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration_file.html">PyReduce Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="instruments.html">Supporting Custom instruments</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">PyReduce</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">pyreduce package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="wavecal_linelist.html">Wavelength Calibration</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="modules.html">PyReduce</a><ul>
      <li>Previous: <a href="modules.html" title="previous chapter">PyReduce</a></li>
      <li>Next: <a href="pyreduce.clib.html" title="next chapter">pyreduce.clib package</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2019, Ansgar Wehrhahn.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/pyreduce.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>